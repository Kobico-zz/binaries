!function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=367)}({367:function(e,t,i){!function(e){window.gigya.gaeDomain;"https"==window.gigya.localInfo.protocol&&window.gigya.gaeDomain,void 0===e.plugins&&(e.plugins={});var t=e.plugins;if(void 0===t.comments){var i=window.gigya._.getCdnResource("/gs/i/comments/"),o=function(e,t,i){this._c=e,this._p=t,this._i=i,this.container=document.getElementById(this._p.containerID),this.containerID=t.containerID,this.loadTemplates(this._p.templates),this.loadState()},n={instances:{},instances_size:0,extend:function(e,t){if(t instanceof Array){for(var i in t)o(e,t[i]);return e}return o(e,t);function o(e,t){for(var i in t)"function"!=typeof i&&(null!=t[i]&&"object"==typeof t[i]?e[i]=o(e[i]||{},t[i]):e[i]=t[i]);return e}},getText:function(e,t,i){return window.gigya.pluginUtils.lang.getLocalizedText("gigya.services.comments.plugins.comments.js",e,n.lang,t,i)},drawComments:function(e,t,i){if(null==e)return"";i||(i=0);for(var o=[],n=0;n<e.length;n++){var s=e[n];o.push(s.getHTML())}return o.join("")},isSharePossible:function(){return 0==document.location.href.indexOf("http")&&(!window.__gigAPIAdapterSettings||"http://www.gigya.com/"!=document.location.href)},countChildren:function(e,t){var i=e[t];if(!i)return 0;var o=i.childrenCount;if(!o){o=0;for(var n=0;n<i.length;n++)i[n].isRemovedComment()||o++,o+=this.countChildren(e,i[n].id)}return e[t].childrenCount=o,o},buildCommentsTree:function(e,t,i,o){for(var n={},s=[],m=[],g={},r=0;r<e.length;r++)if(!g[e[r].ID]){g[e[r].ID]=!0;var l=new a(e[r],i);m.push(l),null!=l.parentID?(n[l.parentID]=n[l.parentID]||[]).push(l):l.parentID=0}for(r=0;r<m.length;r++){var d=n[(l=m[r]).id];if(d&&d.length>0&&(l.children=d,l.childrenCount=this.countChildren(n,l.id)),0==l.parentID&&(l.index=s.length,s.push(l)),null==l.level){for(var c=l,u=-1;null!=c;){if(c.level){u+=c.level+1;break}c=i.commentsInstances[c.parentID],u++}l.level=u,l.data.level=u}}return s},changeCSS:function(e,t,i){try{for(var o,n=!1,s=0;s<document.styleSheets.length;s++){document.styleSheets[s].rules?o="rules":document.styleSheets[s].cssRules&&(o="cssRules");for(var a=0;a<document.styleSheets[s][o].length;a++)if(document.styleSheets[s][o][a].selectorText==e&&document.styleSheets[s][o][a].style[t]){document.styleSheets[s][o][a].style[t]=i,n=!0;break}n||(document.styleSheets[s].insertRule?document.styleSheets[s].insertRule(e+" { "+t+": "+i+"; }",document.styleSheets[s][o].length):document.styleSheets[s].addRule&&document.styleSheets[s].addRule(e,t+": "+i+";"))}}catch(e){}},defaults:{css:[".gig-comments-container *, div.gig-comments-container, .gig-comments-container span, .gig-comments-container a:hover, .gig-comments-container a:visited, .gig-comments-container a:link, .gig-comments-container a:active{","padding:0px;margin:0px;color:inherit;text-decoration:none;width:auto;float:none;","font-family:arial;font-size:12px;color:#4D4D4D;position:static;text-align:left;vertical-align:baseline; }","div.gig-comments-comment-body ul {padding-left:20px;}","div.gig-comments-comment-body li {list-style-type:disc}",".gig-comments-container td, .gig-comments-container tr {vertical-align:middle;}",".gig-comments-container b{font-weight:bold;} .gig-comments-container u{text-decoration:underline} .gig-comments-container i{font-style:italic}","a.gig-comments-button,a:hover.gig-comments-button,a:link.gig-comments-button,a:active.gig-comments-button,a:visited.gig-comments-button {","line-height: 15px;position:relative;border-radius: 3px; color:#4d4d4d;cursor:pointer;","font-size: 11px;padding: 0 5px; border: 1px solid #C5C7C7;display:inline-block;zoom:1;vertical-align:middle; text-align:center;","box-shadow:0 0 2px RGBA(0,0,0,0.15);-webkit-box-shadow:0 0 2px RGBA(0,0,0,0.15);-moz-box-shadow:0 0 2px RGBA(0,0,0,0.15);}","a.gig-comments-button,a:link.gig-comments-button,a:active.gig-comments-button,a:visited.gig-comments-button {",'background: #FFFFFF; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#FFFFFF", endColorstr="#EAEBEB");',"background: -webkit-gradient(linear, left top, left bottom, from(#FFFFFF), to(#EAEBEB));","background: -moz-linear-gradient(top,  #FFFFFF,  #EAEBEB)}","a.gig-comments-button-disabled,a:hover.gig-comments-button-disabled,a:link.gig-comments-button-disabled,a:active.gig-comments-button-disabled,a:visited.gig-comments-button-disabled {","color:#b4b4b4;cursor:default;",'background: #EBEBEB; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#EBEBEB", endColorstr="#FFFFFF");',"background: -webkit-gradient(linear, left top, left bottom, from(#EBEBEB), to(#FFFFFF));","background: -moz-linear-gradient(top,  #EBEBEB,  #FFFFFF)}",".gig-comments-postButton-container {overflow:hidden}",".gig-comments-container a {zoom:1}","div.gig-comments-comment{background-color:#fff;padding-top:10px;padding-right:10px;text-align:left;zoom:1;}","div.gig-comments-comment-child{margin-top:5px;background-color:#F3F3F3;padding:10px;text-align:left;zoom:1;}","div.gig-comments-comment-outstanding {background-color:#EAF9F9; margin-top: 5px; padding-bottom: 10px; padding-left:10px;}","div.gig-comments-comment-facebook{background-color:#EEEFF4}","div.gig-comments-comment-body{color:#4d4d4d;padding-top:5px;padding-bottom:5px;}",".gig-comments-container a.gig-comments-comment-mediaItem {display:block;text-decoration:underline;color:#0796c6; }","div.gig-comments-comment-body-pending{color:#919191;}","div.gig-comments-outstanding-badge {background-image:url('"+i+"outstanding_badge.png');background-repeat:no-repeat;background-position: left top; float:right;width:35px;height:30px;}","div.gig-comments-photoImageSmall{text-align:right;width:32px;height:32px;}","div.gig-comments-photoImageLarge{text-align:right;width:48px;height:48px;}","div.gig-comments-providerLogo{margin-top:-14px;text-align:right;}","div.gig-comments-photo-container {margin-right:8px;float:left;width:48px;}","div.gig-comments-comment-photo-container {margin-right:10px;width:32px;}","span.gig-comments-username{float:left;font-weight:bold;color:#2181CA}","span.gig-comments-comment-username {float:none}","span.gig-comments-comment-time{padding-left: 5px; white-space:nowrap;text-align:left;font-size:11px;color:#919191;padding-top:1px;}","span.gig-comments-comment-newIndicator {padding-left: 10px; color: #FF8900; font-weight: bold; font-size: 11px;}","span.gig-comments-comment-viaFacebook{white-space:nowrap;text-align:right; color:#808281;float:right}","span.gig-comments-comment-viaFacebook-text{color:#919191;font-size:11px;padding-left:5px}","textarea.gig-comments-textarea{overflow:auto;word-wrap:break-word;zoom:1;hasLayout:true;height:78px;padding:0px;resize: none;border:none;background-image:url('"+i+"1x1.png');}","div.gig-comments-textarea-wrapper{border-radius:3px;margin: 0 0 5px; zoom:1;hasLayout:true;background-color:white;border: 1px solid #C0C0C0;height:88px;box-shadow:inset 0 0 4px #DCDCDC; -moz-box-shadow:inset 0 0 4px #DCDCDC; -webkit-box-shadow:inset 0 0 4px #DCDCDC;}","div.gig-comments-headerText{color:#4d4d4d;padding: 3px 0 7px;overflow:hidden;}","span.gig-comments-logoutLink {cursor:pointer;font-size:11px;color:#2181CA}","div.gig-comments-checkboxImage{float:left;background-repeat:no-repeat;background-position:center;margin-right:5px;width: 11px; height: 16px;background-image:url('"+i+"checkbox.gif')}","div.gig-comments-checkboxProviderImage{background-repeat:no-repeat;width: 16px;height:16px;float:left;}","div.gig-comments-checkbox {float:left;cursor:pointer;margin-left:5px;margin-right:5px;overflow:hidden;width:34px;}","div.gig-comments-checkboxImage-checked{background-image:url('"+i+"checkbox_Checked.gif')}","div.gig-comments-loginUI, div.gig-comments-guestUI{z-index:99994;position:absolute;background-color:#FFFFFF;border: 1px solid #C5C7C7}","div.gig-comments-loginUI {height:110px;border-radius: 0 0 3px 3px;}","div.gig-comments-loginUI-pleaseLogin {margin-left:5px;margin:5px;font-size:11px;color: #4D4D4D}","div.gig-comments-guestUI {border-radius: 0 3px 3px 3px}","div.gig-comments-guestDropdown{overflow:hidden;width:150px;font-family:arial;font-size:10px;color:#919191;margin-top:16px;margin-left:13px;margin-right:13px;margin-bottom:8px;z-index:99995}","input.gig-comments-textbox{border-radius:3px;width: 145px; height:24px; line-height:22px;font-size:12px;color:#919191;border:1px solid #C0C0C0;padding-left:2px;}","input.gig-comments-textbox-nickname, input.gig-comments-textbox-email {width:100%;}","input.gig-comments-textbox-nickname {margin-bottom:10px;}","input.gig-comments-textbox-title {width:100%;height: 27px;line-height:25px; color: #4D4D4D;padding-left:5px;margin-bottom:10px;}","div.gig-comments-error-text{color:#e70707;font-weight:bold}","div.gig-comments-shareTo{white-space:nowrap;line-height:16px;zoom:1;}","div.gig-comments-replyBox{margin-top:5px;background-color:#F3F3F3;padding:10px;padding-top:12px;}","div.gig-comments-loginCanvas-container {zoom:1;overflow:hidden;margin-bottom:10px;}","div.gig-comments-close-icon{float:right;cursor:pointer;background-repeat:no-repeat;width: 15px; height: 15px;background-image:url('"+i+"close_icon.png')}","div.gig-comments-awaiting-moderation{font-weight:bold;font-size:11px;color:#4D4D4D;font-style:italic}","div.gig-comments-commentList-header{overflow:hidden;font-size:16px;color:#4d4d4d;font-weight:bold;line-height:20px;zoom:1;}","div.gig-comments-commentList-header-commentsCount{padding-top:30px;float:left;}","div.gig-comments-headerLinks{padding-top:30px;float:right;zoom:1;}","a.gig-comments-headerLinks-rss,a:hover.gig-comments-headerLinks-rss,a:link.gig-comments-headerLinks-rss,a:active.gig-comments-headerLinks-rss,a:visited.gig-comments-headerLinks-rss, ","a.gig-comments-headerLinks-subscribe, a:hover.gig-comments-headerLinks-subscribe,a:link.gig-comments-headerLinks-subscribe,a:active.gig-comments-headerLinks-subscribe,a:visited.gig-comments-headerLinks-subscribe {","font-weight:normal;color:#2181CA;text-decoration:underline;font-size:11px;cursor:pointer;}","span.gig-comments-vertical-seperator {color:#d8d9d9;margin:0 5px;}","div.gig-comments-dottedLine{background-image:url('"+i+"SepLine.gif');height: 1px;background-repeat: repeat-x;margin-top:5px}","div.gig-comments-expand-arrow{vertical-align:bottom;display:inline-block; *display:inline; zoom:1; background-repeat:no-repeat; background-position:center center; width: 10px; height:13px; background-image:url('"+i+"icon_ExpandReply.png')}","div.gig-comments-collapse-arrow{vertical-align:bottom;display:inline-block; *display:inline; zoom:1; background-repeat:no-repeat; background-position:center center; width: 10px; height:13px; background-image:url('"+i+"icon_CollapsReply.png')}","div.gig-comments-replies-length-container{zoom:1;padding-left:10px;display:inline-block;*display:inline;cursor:pointer; white-space:nowrap;}","a.gig-comments-link,a:hover.gig-comments-link,a:link.gig-comments-link,a:active.gig-comments-link,a:visited.gig-comments-link {font-family:arial; font-size:11px; color: #2181CA;text-decoration:underline}","span.gig-comments-replies-length {display:inline;font-family:arial; font-size:11px; color: #2181CA;text-decoration:underline}","div.gig-comments-guestError{color:#e70707;font-size:10px;width:150px;float:left}","div.gig-comments-email-not-displayed-publicly{font-size:10px;padding-top:5px;padding-bottom:5px;}","div.gig-comments-providers{float:left;}","div.gig-comments-providers-container{overflow:hidden;zoom:1;float:left;}","div.gig-comments-providerIcons{margin: 0 5px 0 11px;font-size:1px;background-position:center;height:22px;float:left;background-image:url('"+i+"ButtonLogin_Icons.png');background-repeat:no-repeat;width:57px;}","div.gig-comments-showMoreComments-container{width:100%}","div.gig-comments-showMoreComments{height:35px;cursor:pointer;text-align:center;margin-top:10px;color:#4D4D4D; border:1px solid #E5E5E5;background-color:#f9f9f9}","div.gig-comments-showMoreComments-over{height:35px;text-align:center;color:#f3f3f3;border:1px solid #CFCFCF;background-color:#F3F3F3}","div.gig-comments-showMoreComments-text{padding-top:10px;font-weight:bold;text-align:center;}","div.gig-comments-showMoreComments-progress, div.gig-comments-progress {margin:5px auto auto;width:24px;height:24px;background-repeat:no-repeat;background-image:url('"+i+"progress_ani.gif')}","div.gig-comments-comment-flag{cursor:pointer;visibility:hidden;text-align:right;float:right;width: 14px; height:14px;background-image:url('"+i+"flag_icon.png')}","div.gig-comments-comment-flag-over{visibility:visible}","div.gig-comments-comment-flag-submitted{text-align:right;float:right;width: 14px; height:14px;background-image:url('"+i+"flag_icon.png')}","div.gig-comments-comment-remove{cursor:pointer;visibility:hidden;text-align:right;float:right;width: 7px; height:7px;background-image:url('"+i+"remove_icon.gif');background-repeat:no-repeat;background-position:center;}","div.gig-comments-comment-remove-over{visibility:visible}","div.gig-comments-dialog-caption{background-color: #f3f3f3; padding: 5px 5px 5px 12px;overflow:auto;zoom:1;font-size: 14px;font-weight:bold;color: #4d4d4d;}","div.gig-comments-dialog-body{padding:24px 12px 12px 12px;}","div.gig-comments-dialog-buttons{margin-top:12px;}","a.gig-comments-button-cancel,a:hover.gig-comments-button-cancel,a:link.gig-comments-button-cancel,a:active.gig-comments-button-cancel,a:visited.gig-comments-button-cancel, ","a.gig-comments-button-flagThisComment,a:hover.gig-comments-button-flagThisComment,a:link.gig-comments-button-flagThisComment,a:active.gig-comments-button-flagThisComment,a:visited.gig-comments-button-flagThisComment ","a.gig-comments-button-remove,a:hover.gig-comments-button-remove,a:link.gig-comments-button-remove,a:active.gig-comments-button-remove,a:visited.gig-comments-button-remove ","{line-height:24px;font-size:12;padding:0 10px;}","a.gig-comments-button-subscribe,a:hover.gig-comments-button-subscribe,a:link.gig-comments-button-subscribe,a:active.gig-comments-button-subscribe,a:visited.gig-comments-button-subscribe {","line-height:22px;font-size:12;margin-left:7px;font-weight:bold;","}","div.gig-comments-dialog-subscribe-emailTextbox-container {float:left;}","div.gig-comments-dialog-subscribe-enterYourEmail {margin-bottom:10px;}","input.gig-comments-dialog-subscribe-emailTextbox {width: 260px;color: #4D4D4D}","a.gig-comments-button-cancel,a:hover.gig-comments-button-cancel,a:link.gig-comments-button-cancel,a:active.gig-comments-button-cancel,a:visited.gig-comments-button-cancel ","{margin-right: 10px;}","div.gig-comments-dialog-body-remove {font-weight:bold}","a.gig-comments-button-flagThisComment,a:hover.gig-comments-button-flagThisComment,a:link.gig-comments-button-flagThisComment,a:active.gig-comments-button-flagThisComment,a:visited.gig-comments-button-flagThisComment ","a.gig-comments-button-remove,a:hover.gig-comments-button-remove,a:link.gig-comments-button-remove,a:active.gig-comments-button-remove,a:visited.gig-comments-button-remove ","{font-weight:bold}","div.gig-comments-star {background-repeat:no-repeat;margin-right:3px; width: 13px; height:13px;float:left;background-image:url('"+i+"RateIcon_13.png')}","div.gig-comments-star-half {background-image:url('"+i+"RateIcon_13_half.png')}","div.gig-comments-star-full {background-image:url('"+i+"RateIcon_13_pressed.png')}","div.gig-comments-star-editable, div.gig-comments-star-editable-empty, div.gig-comments-addComment-ratings-error div.gig-comments-star-editable-empty, div.gig-comments-star-myRating {background-repeat:no-repeat;padding-right:4px; width: 21px; height:21px;float:left;background-image:url('"+i+"RateIcon_21.png')}","div.gig-comments-star-editable, div.gig-comments-star-editable-empty, div.gig-comments-addComment-ratings-error div.gig-comments-star-editable-empty {cursor:pointer;}","div.gig-comments-star-editable-half, div.gig-comments-star-myRating-half {background-image:url('"+i+"RateIcon_21_half.png')}","div.gig-comments-star-editable-full, div.gig-comments-star-myRating-full, div.gig-comments-addComment-ratings-error div.gig-comments-star-editable-full {background-image:url('"+i+"RateIcon_21_pressed.png')}","div.gig-comments-addComment-ratings-error .gig-comments-star-editable {background-image:url('"+i+"RateIcon_21_error.png');}","div.gig-comments-addComment-ratings-stars-container {float:left;margin-bottom:15px;}","div.gig-comments-addComment-ratings-ratingName {float:left;margin-right:15px;margin-top:4px;}","div.gig-comments-addComment-ratings-details {float:left;margin-left: 3px; color:#919191;margin-top:4px;}","div.gig-comments-addComment-ratings {overflow:hidden;zoom:1}","div.gig-comments-addComment-label {margin-bottom:3px;}","div.gig-comments-commentBox {margin-top:15px;overflow:hidden;zoom:1;}","div.gig-comments-commentBox-bottom {margin-top:35px;padding-top:5px;border-top:1px solid #CFCFCF}","div.gig-comments-rating {zoom:1;overflow:hidden;float:left;padding-bottom:12px;}","div.gig-comments-title {font-weight:bold; font-size: 14px;float:left;padding-bottom:12px;}","span.gig-comments-mandatoryMark {color:#e70707;font-weight:bold;}","div.gig-validation-error {display:none;color: #ce585a;text-align:center;line-height:22px;background:#fee9ea;margin-top:7px;}","a.gig-comments-button-post,a:hover.gig-comments-button-post,a:link.gig-comments-button-post,a:active.gig-comments-button-post,a:visited.gig-comments-button-post,","a.gig-comments-button-ok,a:hover.gig-comments-button-ok,a:link.gig-comments-button-ok,a:active.gig-comments-button-ok,a:visited.gig-comments-button-ok {","line-height:20px;font-weight:bold;font-size:12px;padding:0 10px;float:right;white-space:nowrap}","a.gig-comments-dropdown,a:hover.gig-comments-dropdown,a:link.gig-comments-dropdown,a:active.gig-comments-dropdown,a:visited.gig-comments-dropdown {","font-weight:bold;line-height: 22px;position:relative;border-radius: 3px; color:#4d4d4d;cursor:pointer;","font-size: 13px;padding-left: 10px; border: 1px solid #C5C7C7;display:inline-block;zoom:1; vertical-align:middle; text-align:center;","box-shadow:0 0 2px RGBA(0,0,0,0.15);-webkit-box-shadow:0 0 2px RGBA(0,0,0,0.15);-moz-box-shadow:0 0 2px RGBA(0,0,0,0.15);}","a.gig-comments-dropdown,a:link.gig-comments-dropdown,a:active.gig-comments-dropdown,a:visited.gig-comments-dropdown {",'background: #FFFFFF; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#FFFFFF", endColorstr="#EAEBEB");',"background: -webkit-gradient(linear, left top, left bottom, from(#FFFFFF), to(#EAEBEB));","background: -moz-linear-gradient(top,  #FFFFFF,  #EAEBEB)}","a:hover.gig-comments-dropdown, a.gig-comments-dropdown-down, a:hover.gig-comments-dropdown-down,a:link.gig-comments-dropdown-down,a:active.gig-comments-dropdown-down,a:visited.gig-comments-dropdown-down {",'background: #EAEBEB; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#EAEBEB", endColorstr="#FFFFFF");',"background: -webkit-gradient(linear, left top, left bottom, from(#EAEBEB), to(#FFFFFF));","background: -moz-linear-gradient(top,  #EAEBEB,  #FFFFFF)}","div.gig-comments-dropdown-button {","border-radius: 0 3px 3px 0; margin-left:13px;float:lef;width: 21px; height: 22px; display:inline-block;zoom:1;",'background: #EAEBEB; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#FFFFFF", endColorstr="#DADADA");',"background: -webkit-gradient(linear, left top, left bottom, from(#FFFFFF), to(#DADADA));","background: -moz-linear-gradient(top,  #FFFFFF,  #DADADA)}","a.gig-comments-dropdown-login div.gig-comments-dropdown-button {margin-left:3px}","div.gig-comments-dropdown-login-text {min-width:34px}","a.gig-comments-dropdown-login-native,a:hover.gig-comments-dropdown-login-native,a:link.gig-comments-dropdown-login-native,a:active.gig-comments-dropdown-login-native,a:visited.gig-comments-dropdown-login-native {padding:0 10px;}","a:hover.gig-comments-dropdown div.gig-comments-dropdown-button, a.gig-comments-dropdown-down div.gig-comments-dropdown-button {",'background: #EAEBEB; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#DADADA", endColorstr="#FFFFFF");',"background: -webkit-gradient(linear, left top, left bottom, from(#DADADA), to(#FFFFFF));","background: -moz-linear-gradient(top,  #DADADA,  #FFFFFF)}","div.gig-comments-login-container {zoom:1;overflow:hidden;line-height:24px;}","div.gig-comments-loginCanvas {zoom:1;overflow:hidden}","span.gig-comments-logoutLink-container {float:left;}","span.gig-comments-login {font-weight:bold;font-size:13px;}","div.gig-comments-addCommentFooter {zoom:1;overflow:hidden}","td.gig-comments-commentData {width:99%}","div.gig-comments-commentData-header {overflow:hidden;zoom:1;}","div.gig-comments-ratingAndTitle {overflow:hidden;zoom:1;}","div.gig-comments-replyButtonAndCount {float:left;overflow:hidden;zoom:1;}","div.gig-comments-dropdown-button-arrow {background-image:url('"+i+"arrow.gif');height:22px;width: 21px;background-repeat:no-repeat;background-position:center;}","div.gig-comments-dialog {border: 6px solid #858585; border-radius: 5px; background-color:#FFFFFF;xheight:140px;}","div.gig-comments-dialog-closeIcon {background-image:url('"+i+"close_icon.png');width:15px;height:15px; float:right;cursor:pointer;}","div.gig-comments-dialog-smallCloseIcon {background-image:url('"+i+"smallcloseicon.png');width:7px;height:15px; float:right;cursor:pointer;background-position:center;background-repeat:no-repeat;}","div.gig-comments-usernameAndTime {float:left;}","div.gig-comments-dropdown-text {float:left}","div.gig-comments-vote {float:right;text-align:right;font-size:11px;white-space:nowrap;margin-left:7px;vertical-align:middle;}","div.gig-comments-vote-up {background-image:url('"+i+"thumbsup_hover.png');width:15px;height:15px;}","div.gig-comments-vote-down {background-image:url('"+i+"thumbsdown_hover.png');width:15px;height:15px; }","div.gig-comments-vote-value {font-size:11px;vertical-align:middle;margin-left:4px;display:inline-block;*display:inline;*width:21px;text-align:right;}","div.gig-comments-vote-value-neg {width:auto;min-width: auto;margin-left:}","a.gig-comments-button-vote, a:hover.gig-comments-button-vote,a:link.gig-comments-button-vote,a:active.gig-comments-button-vote,a:visited.gig-comments-button-vote {","margin:0;padding:0;margin-left:4px; box-shadow:none;-webkit-box-shadow:none;-moz-box-shadow:none}","div.gig-comments-dialog-subscribe-error {color: #ce585a;font-size:11px;margin-top:5px;}","div.gig-comments-dialog-body-confirmation {text-align:center;line-height:20px;padding-bottom:22px;}","div.gig-comments-dialog-subscribe-okIcon {background-image:url('"+i+"ok_icon.png');width:14px;height:14px;position:relative;top:2px;margin-right:2px;display:inline-block;}","a.gig-comments-follow, a:hover.gig-comments-follow,a:link.gig-comments-follow,a:active.gig-comments-follow,a:visited.gig-comments-follow ","{cursor:pointer;margin-left:27px;border-left:1px solid #d8d9d9; color:#4D4D4D;padding-left:20px;","background-image:url('"+i+"follow.png');background-repeat:no-repeat;background-position:5px;margin-right:5px;display:inline-block;}","a.gig-comments-following, a:hover.gig-comments-following,a:link.gig-comments-following,a:active.gig-comments-following,a:visited.gig-comments-following "," {background-image:url('"+i+"following.png')}","a.gig-comments-unfollow, a:hover.gig-comments-unfollow,a:link.gig-comments-unfollow,a:active.gig-comments-unfollow,a:visited.gig-comments-unfollow ","{background-image:url('"+i+"unfollow.png')}","a.gig-comments-moreProvider, a:hover.gig-comments-moreProvider,a:link.gig-comments-moreProvider,a:active.gig-comments-moreProvider,a:visited.gig-comments-moreProvider ","{display:inline-block;font-size:12px;width: 100px;cursor:pointer;margin-bottom:5px;line-height:20px;}","a.gig-comments-more, a:hover.gig-comments-mor,a:link.gig-comments-more,a:active.gig-comments-more,a:visited.gig-comments-more {margin-left:5px;line-height:20px;color:#2181CA;text-decoration:underline;line-height:16px;}","div.gig-comments-dialog-moreProviders {padding:0;width: 300px;}","div.gig-comments-dialog-caption-moreProviders {font-size:12px;padding:0 5px;}","div.gig-comments-dialog-body-moreProviders{padding:5px 5px 0 5px;}","div.gig-comments-dialog-caption-moreProviders {padding:3px 5px;}","div.gig-comments-moderator-edit-text {font-weight:bold;margin-bottom:10px;}","div.gig-comments-myRating {overflow:hidden;}","div.gig-comments-myRating-label {float:left;margin-top:5px;margin-right:5px;}","div.gig-comments-mySummary-label {}","div.gig-comments-mySummary-value, div.gig-comments-myReview-value {font-style: italic;}","div.gig-comments-mySummary-label, div.gig-comments-myReview-label {margin-bott: 10px;}","div.gig-comments-mySummary-value {margin-bottom:27px;}","div.gig-comments-updatesStrip {background-color: #FFFBCA;margin: 10px 0;text-align:center;padding:5px;}","span.gig-comments-updatesStrip-link {color:#2181CA;text-decorations:underline;cursor:pointer;font-size: inherit;}"],nonMobileCSS:[".gig-comments-container * {border:none;-moz-border-radius:0;border-radius:0;background:none;}",".gig-comments-container a:focus, .gig-comments-container input:focus, .gig-comments-container textarea:focus {outline: none;}","input.gig-comments-textbox {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;padding:0 4px;background-color:white;border: 1px solid #C0C0C0;height:24px;box-shadow:inset 0 0 4px #DCDCDC; -moz-box-shadow:inset 0 0 4px #DCDCDC; -webkit-box-shadow:inset 0 0 4px #DCDCDC;}","a:hover.gig-comments-button, a.gig-comments-button-down,a:link.gig-comments-button-down,a:active.gig-comments-button-down,a:visited.gig-comments-button-down {",'background: #EAEBEB; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#EAEBEB", endColorstr="#FFFFFF");',"background: -webkit-gradient(linear, left top, left bottom, from(#EAEBEB), to(#FFFFFF));","background: -moz-linear-gradient(top,  #EAEBEB,  #FFFFFF)}","span.gig-comments-username{white-space:nowrap}","div.gig-comments-updatesStrip {font-size: 11px}"],mobileCSS:["div.gig-comments-comment-flag{display:none}","a.gig-comments-button-down,a:link.gig-comments-button-down,a:active.gig-comments-button-down,a:visited.gig-comments-button-down {",'background: #EAEBEB; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#EAEBEB", endColorstr="#FFFFFF");',"background: -webkit-gradient(linear, left top, left bottom, from(#EAEBEB), to(#FFFFFF));","background: -moz-linear-gradient(top,  #EAEBEB,  #FFFFFF)}",".gig-comments-container *, div.gig-comments-container, .gig-comments-container span, .gig-comments-container a:hover, .gig-comments-container a:visited, .gig-comments-container a:link, .gig-comments-container a:active{","font-size:16px;font-family:sans-serif;}","span.gig-comments-comment-time {display:none}","a.gig-comments-button,a:hover.gig-comments-button,a:link.gig-comments-button,a:active.gig-comments-button,a:visited.gig-comments-button {","line-height: 28px;}","div.gig-comments-commentList-footer, div.gig-comments-commentList-header, div.gig-commentList, div.gig-comments-commentBox {margin-left:3px; margin-right:3px;}","div.gig-comments-commentList-header {font-size: 18px;}","a.gig-comments-button-reply, div.gig-comments-vote-value {font-size: 14px}","a.gig-comments-button-post, a:hover.gig-comments-button-post,a:link.gig-comments-button-post,a:active.gig-comments-button-post,a:visited.gig-comments-button-post {line-height:33px}","div.gig-comments-replies-length-container {display:none}","div.gig-comments-vote-up {background-image:url('"+i+"mobile_vote_up.png');width:28px;height:28px;}","div.gig-comments-vote-down {background-image:url('"+i+"mobile_vote_down.png');width:28px;height:28px; }","a.gig-comments-button-down div.gig-comments-vote-up {background-image:url('"+i+"mobile_vote_up_pressed.png');}","a.gig-comments-button-down div.gig-comments-vote-down {background-image:url('"+i+"mobile_vote_down_pressed.png'); }","a.gig-comments-button-vote-down, a:hover.gig-comments-button-vote-down,a:link.gig-comments-button-vote-down,a:active.gig-comments-button-vote-down,a:visited.gig-comments-button-vote-down {","margin-left:8px;}","a.gig-comments-rss-icon,a:hover.gig-comments-rss-icon,a:link.gig-comments-rss-icon,a:active.gig-comments-rss-icon,a:visited.gig-comments-rss-icon {display:none}","div.gig-comments-loginCanvas {margin-bottom:10px;}","a.gig-comments-dropdown-login div.gig-comments-dropdown-button {float:right;width:33px;height:33px}","div.gig-comments-dropdown-button-arrow {width: 32px;height:33px;}","a.gig-comments-dropdown,a:hover.gig-comments-dropdown,a:link.gig-comments-dropdown,a:active.gig-comments-dropdown,a:visited.gig-comments-dropdown {","line-height:33px;display:block;overflow:auto;","}","div.gig-comments-providerIcons {display:none}","div.gig-comments-loginUI {height:240px}","div.gig-comments-loginUI-content {margin-top:20px;}","div.gig-comments-headerText{padding-bottom:2px}","div.gig-comments-showMoreComments-text {padding-top:8px;}","div.gig-comments-checkbox {width:auto;}",".gig-comments-container textarea {width:100%;-moz-box-sizing: content-box;-webkit-box-sizing: content-box;box-sizing: content-box;}","div.gig-comments-title {font-size:17px;}","input.gig-comments-textbox {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;margin-bottom:10px;}","div.gig-comments-star {background-repeat:no-repeat;margin-right:3px; width: 21px; height:21px;float:left;background-image:url('"+i+"RateIcon_21.png')}","div.gig-comments-star-half {background-image:url('"+i+"RateIcon_21_half.png')}","div.gig-comments-star-full {background-image:url('"+i+"RateIcon_21_pressed.png')}","div.gig-comments-star-editable {background-repeat:no-repeat;margin-right:7px; width: 28px; height:28px;float:left;cursor:pointer;background-image:url('"+i+"RateIcon_28.png')}","div.gig-comments-star-editable-half {background-image:url('"+i+"RateIcon_28_half.png')}","div.gig-comments-star-editable-full, div.gig-comments-addComment-ratings-error div.gig-comments-star-editable-full {background-image:url('"+i+"RateIcon_28_pressed.png')}","div.gig-comments-addComment-ratings-error .gig-comments-star-editable {background-image:url('"+i+"RateIcon_28_error.png')}","div.gig-comments-rating {margin-right:3px;}","div.gig-comments-addComment-ratings-ratingName {margin-right:7px;}","label.gig-comments-checkboxProvider {margin-left:5px}","div.gig-comments-updatesStrip {margin: 10px 3px;}","span.gig-comments-updatesStrip-link {display:block;text-align:center;}"]},templates:{_map:{},get:function(e){return this._map[e]},getMapCopy:function(){return window.gigya.utils.object.clone(this._map)},set:function(e,t){this._map[e]=t instanceof Array?t.join(""):t}},createInstance:function(e,t,i){var s=document.getElementById(t.containerID);if(null!=s){s.innerHTML="",t.streamID||(t.streamID=0);var a=new o(e,t,i);a.id=t.containerID+"_"+n.instances_size,n.instances[a.id]=a,n.instances_size++,a.start()}},setDefaultTemplates:function(){n.templates.set("commentContainer",['<div style="overflow:hidden;zoom:1;" id="$commentContainerId">','<div onmouseover="$onmouseover" onmouseout="$onmouseout">${comment}</div>',"$commentReplyPlaceholder",'<div id="gig-replies-$commentID">$childComments\x3c!-- empty divs=100% height IE --\x3e</div>',"$dottedLine","</div>"]),n.templates.set("comment",['<div class="gig-comments-$classname" style="margin-left:${marginLeft}px;">',"${ratings}${titlePlaceholder}",'<table cellspacing="0" cellpadding="0" style="width:100%"><tr>','<td style="vertical-align:top"><div class="gig-comments-photo-container gig-comments-$rootClass-photo-container">$photoDiv</div></td>','<td class="gig-comments-commentData">','<div class="gig-comments-commentData-header">','<div class="gig-comments-usernameAndTime">','<span class="gig-comments-username gig-comments-$rootClass-username">$username</span>','<span class="gig-comments-$rootClass-newIndicator" style="display:none">$newText</span>','<span class="gig-comments-$rootClass-time">$dateString</span>',"</div>","$remove","</div>","$errorPlaceholder",'<div class="gig-comments-comment-body">',"${outstandingBadgePlaceholder}","${moderatorEditTextPlaceholder}","${body}","${mediaItemPlaceholder}","</div>",'<div class="gig-comments-replyButtonAndCount">$replyButton $repliesCountPlaceholder</div>',"$vote $flag","</td></tr>","</table>","</div>"]),n.templates.set("facebookComment",['<div class="gig-comments-$classname" style="margin-left:${marginLeft}px;">','<table cellspacing="0" cellpadding="0" style="width:100%"><tr>','<td style="vertical-align:top"><div class="gig-comments-photo-container gig-comments-$rootClass-photo-container">$photoDiv</div></td>','<td class="gig-comments-commentData">','<div class="gig-comments-commentData-header">','<div class="gig-comments-usernameAndTime">','<span class="gig-comments-username gig-comments-$rootClass-username">$username</span>','<span class="gig-comments-$rootClass-time">$dateString</span>',"</div>",'<span class="gig-comments-$rootClass-viaFacebook">','<img alt="" src="'+window.gigya._.getCdnResource("/gs/i/comments/FB_logo.gif")+'" /><span class="gig-comments-$rootClass-viaFacebook-text">Via Facebook</span>',"</span>","</div>",'<div class="gig-comments-comment-body">$body</div>',"</td>","</tr></table>","</div>"]),n.templates.set("flag",['<div id="gig-flag-$commentID" class="gig-comments-comment-flag" onclick="$onFlagClicked; return false;"></div>']),n.templates.set("remove",['<div id="gig-remove-$commentID" class="gig-comments-comment-remove" onclick="$onRemoveClicked; return false;"></div>']),n.templates.set("vote",function(e){return['<div class="gig-comments-vote" id="gig-vote-$commentID">',e.displayPosNegVotes?'<div id="gig-voteValuePos-$commentID" class="gig-comments-vote-value gig-comments-vote-value-pos"></div>':'<div id="gig-voteValue-$commentID" class="gig-comments-vote-value"></div>','<a id="gig-voteUp-$commentID" href="#" class="gig-comments-button gig-comments-button-vote gig-comments-button-vote-up" onclick="$onVoteUpClick; return false;"><div class="gig-comments-vote-up"></div></a>',(e.allowNegativeVoting?'<a href="#" id="gig-voteDown-$commentID" class="gig-comments-button gig-comments-button-vote gig-comments-button-vote-down" onclick="$onVoteDownClick; return false;"><div class="gig-comments-vote-down"></div></a>':"")+(e.displayPosNegVotes?'<div id="gig-voteValueNeg-$commentID" class="gig-comments-vote-value gig-comments-vote-value-neg"></div>':""),"</div>"].join("")}),n.templates.set("repliesCountPlaceholder",['<div id="gig-comments-comment-$commentID-repliesCountPlaceholder" style="display:inline-block;*display:inline;zoom:1;">$expand_collapse</div>']),n.templates.set("expand_collapse",['<div onclick="$onExapndCollapse" class="gig-comments-replies-length-container"><div id="gig-expand-$commentID" class="gig-comments-expand-arrow"></div><span class="gig-comments-replies-length">$replies_count</span></div>']),n.templates.set("pendingComment",['<div class="gig-comments-$classname" style="margin-left:${marginLeft}px;">',"$ratings $titlePlaceholder",'<table cellspacing="0" cellpadding="0" style="width:100%"><tr>','<td style="vertical-align:top"><div class="gig-comments-photo-container gig-comments-$rootClass-photo-container">$photoDiv</div></td>','<td class="gig-comments-commentData">','<div class="gig-comments-commentData-header">','<div class="gig-comments-usernameAndTime">','<span class="gig-comments-username gig-comments-$rootClass-username">$username</span>','<span class="gig-comments-$rootClass-time">$dateString</span>',"</div>","</div>",'<div class="gig-comments-comment-body gig-comments-awaiting-moderation">$awaiting_moderation_text</div>$errorPlaceholder',"$replyButton $repliesCountPlaceholder $flag","</td></tr>","</table>","</div>"]),n.templates.set("errorPlaceholder",['<div id="$id-error-$commentID" class="gig-comments-error-text">\x3c!-- empty divs=100% height IE --\x3e</div>']),n.templates.set("outstandingBadgePlaceholder",['<div class="gig-comments-outstanding-badge">\x3c!-- empty divs=100% height IE --\x3e</div>']),n.templates.set("moderatorEditTextPlaceholder",['<div class="gig-comments-moderator-edit-text">$moderatorEditText</div>']),n.templates.set("validationErrorPlaceholder",['<div id="$id-validationError" class="gig-validation-error">\x3c!-- empty divs=100% height IE --\x3e</div>']),n.templates.set("mediaItemPlaceholder",['<a href="$mediaItemURL" target="_blank" class="gig-comments-comment-mediaItem">$mediaItemURL</div>']),n.templates.set("replyPlaceholder",['<div id="$id-reply-$commentID"></div>']),n.templates.set("replyButton",['<a href="#" id="$id-replybutton-$commentID" class="gig-comments-button gig-comments-button-reply" onclick="$onReplyClicked;return false;">$reply</a>']),n.templates.set("photoDiv32",'<div class="gig-comments-photoImageSmall gig-comments-$rootClass-photoImageSmall" style="overflow:hidden;visibility:hidden"><img alt="" onload="gigya.comments.plugins.comments.imgOnLoad(this, 32)" src="$photoURL" style="vertical-align:top" /><br />$providerImage</div>'),n.templates.set("photoDiv48",'<div class="gig-comments-photoImageLarge gig-comments-$rootClass-photoImageLarge" style="overflow:hidden;visibility:hidden"><img alt="" onload="gigya.comments.plugins.comments.imgOnLoad(this, 48)" src="$photoURL" style="vertical-align:top" /><br />$providerImage</div>'),n.templates.set("providerImage",'<div class="gig-comments-providerLogo gig-comments-$rootClass-providerLogo"><img alt="" src="$providerImageURL" style="vertical-align:top" /></div>'),n.templates.set("loginCanvas_loggedIn",['<div class="gig-comments-loginCanvas gig-comments-$rootClass-loginCanvas">','<div class="gig-comments-photo-container gig-comments-$rootClass-photo-container">$photoDiv</div>','<div class="gig-comments-headerText gig-comments-$rootClass-headerText">$post_a_new_comment</div>','<span class="gig-comments-username gig-comments-$rootClass-username">$username&#160;</span>$logoutLink',"$followLink","</div>"]),n.templates.set("loginCanvas_loggedIn_guest",['<div class="gig-comments-loginCanvas gig-comments-$rootClass-loginCanvas">','<div class="gig-comments-photo-container gig-comments-$rootClass-photo-container">$photoDiv</div>','<div class="gig-comments-headerText gig-comments-$rootClass-headerText">$post_a_new_comment</div>','<div class="gig-comments-login-container"><span class="gig-comments-username gig-comments-$rootClass-username">$username&#160;</span>$logoutLink','<span class="gig-comments-login gig-comments-or">&#160;&#160;-&#160;${or}&#160;-&#160;&#160;</span>${loginDropdown}</div>',"</div>"]),n.templates.set("logoutLink",['<span class="gig-comments-logoutLink-container">(<span class="gig-comments-logoutLink gig-comments-$rootClass-logoutLink" onclick="$onLogoutClick">$logout</span>)</span>']),n.templates.set("loginCanvas_loggedOut_mobile",['<div class="gig-comments-loginCanvas gig-comments-$rootClass-loginCanvas">','<div class="gig-comments-login-container">${loginDropdown}</div>',"</div>"]),n.templates.set("loginCanvas_loggedOut",['<div class="gig-comments-loginCanvas gig-comments-$rootClass-loginCanvas">','<div class="gig-comments-photo-container gig-comments-$rootClass-photo-container">$photoDiv</div>','<div class="gig-comments-headerText gig-comments-$rootClass-headerText">$post_a_new_comment</div>','<div class="gig-comments-login-container">${loginDropdown}</div>',"</div>"]),n.templates.set("loginCanvas_loggedOutWithGuest",['<div class="gig-comments-loginCanvas gig-comments-$rootClass-loginCanvas">','<div class="gig-comments-photo-container gig-comments-$rootClass-photo-container">$photoDiv</div>','<div class="gig-comments-headerText gig-comments-$rootClass-headerText">$post_a_new_comment</div>','<div class="gig-comments-login-container">${loginDropdown}<span class="gig-comments-login gig-comments-or">&#160;&#160;-&#160;${or}&#160;-&#160;&#160;</span>${guestDropdown}</div>',"</div>"]),n.templates.set("loginDropdown",['<a href="#" id="$id-loginDropdown" onclick="${onLoginClick};return false;" class="gig-comments-dropdown gig-comments-dropdown-login">','<div class="gig-comments-dropdown-text gig-comments-dropdown-login-text">$login</div>','<div class="gig-comments-providerIcons">&#160;</div>','<div class="gig-comments-dropdown-button"><div class="gig-comments-dropdown-button-arrow">&#160;</div></div>',"</a>"]),n.templates.set("loginDropdownNative",['<a href="#" id="$id-loginDropdown" onclick="${onLoginClick};return false;" class="gig-comments-dropdown gig-comments-dropdown-login gig-comments-dropdown-login-native">',"$login","</a>"]),n.templates.set("guestDropdown",['<a href="#" id="$id-guestDropdown" onclick="${onGuestClick};return false;" class="gig-comments-dropdown gig-comments-dropdown-guest">','<div class="gig-comments-dropdown-text gig-comments-dropdown-guest-text">$guest</div>','<div class="gig-comments-dropdown-button"><div class="gig-comments-dropdown-button-arrow">&#160;</div></div>',"</a>"]),n.templates.set("guestBox",['<div class="gig-comments-guestDropdown">',"<div>","$nicknameTextbox","$emailTextbox","</div>",'<div class="gig-comments-email-not-displayed-publicly">${email_not_displayed_publicly}</div>',"$okButton","$guestErrorPlaceholder","</div>"]),n.templates.set("guest-nicknameTextbox",['<input id="$id-nickname" onkeyup="if (this.value.length>=30) {this.value=this.value.substring(0,30);}" class="gig-comments-textbox gig-comments-textbox-nickname" type="textbox" value="$nickname" onblur="if (this.value==\'\') {this.watermarkCleared=false; this.value=\'$nickname\'}" onfocus="if(!this.watermarkCleared) {this.watermarkCleared=true; this.value=\'\';}" />']),n.templates.set("guest-emailTextbox",['<input id="$id-email" class="gig-comments-textbox gig-comments-textbox-email" type="textbox" value="$email" onblur="if (this.value==\'\') {this.watermarkCleared=false; this.value=\'$email\'}" onfocus="if(!this.watermarkCleared) {this.watermarkCleared=true; this.value=\'\';}" />']),n.templates.set("guestErrorPlaceholder",['<div class="gig-comments-guestError" id="$id-guestErrorPlaceholder"></div>']),n.templates.set("okButton",['<a href="#" onclick="$onGuestLogin;return false;" id="$id-okButton" class="gig-comments-button gig-comments-button-ok">$ok</a>']),n.templates.set("addComment",['<div class="gig-comments-$rootClass-commentBox">',"$ratings","$titleLabel","$titleTextbox","$commentLabel","$addCommentTextarea",'<div class="gig-comments-addCommentFooter">','<table cellpadding="0" cellspacing="0" style="width:100%"><tr>','<td><div id="$id-shareTo" class="gig-comments-shareTo gig-comments-$rootClass-shareTo">${share_to}</div></td>','<td style="width:99%;">$providersCheckboxes</td>','<td><div id="$id-postButton" class="gig-comments-postButton-container">$postButton</div></td>',"</tr></table>","</div>","<div>$validationErrorPlaceholder</div>","</div>"]),n.templates.set("addCommentLabel",['<div class="gig-comments-addComment-label gig-comments-addComment-$labelID gig-comments-$rootClass-addComment-label gig-comments-$rootClass-addComment-$labelID">$labelText</div>']),n.templates.set("providersCheckboxes",['<div id="${id}-providersCheckboxes" class="gig-comments-providers-container gig-comments-$rootClass-providers-container" style="visibility:hidden">$providersCheckboxesContent</div>']),n.templates.set("updatesStrip",['<div class="gig-comments-updatesStrip">${text} <span class="gig-comments-updatesStrip-link">${linkText}</span></div>']),n.templates.set("editableRating",function(e){var t=[];t.push('<div id="${id}" class="gig-comments-addComment-ratings">'),t.push('<div class="gig-comments-addComment-label gig-comments-addComment-ratings-ratingName">${name}</div><div class="gig-comments-addComment-ratings-stars-container">');for(var i=0;i<5;i++)t.push('<div id="${id}_'+i+'" gig-baseid="$id" gig-ratingID="$ratingID" gig-rating-details="'+e.details[i]+'" gig-rating="'+(i+1)+'" class="gig-comments-star-editable" $actionAttribute="$onClick" onmouseover="$onMouseOver" onmouseout="$onMouseOut"></div>');return t.push("</div>"),t.push('<div class="gig-comments-addComment-ratings-details" id="${id}_details"></div>'),t.push("</div>"),t.join("")}),n.templates.set("rating",function(e){var t=[];t.push('<div class="gig-comments-rating" title="'+e.value+'">');for(var i=1;i<=5;i++)i<=e.value?t.push('<div class="${starClassName} ${starClassName}-full"></div>'):i-e.value<=.5&&i-e.value>0?t.push('<div class="${starClassName} ${starClassName}-half"></div>'):t.push('<div class="${starClassName} ${starClassName}-empty"></div>');return t.push("</div>"),t.join("")}),n.templates.set("titlePlaceholder",['<div class="gig-comments-title">$title</div>']),n.templates.set("titleTextbox",['<input id="$id-titleTextbox" class="gig-comments-textbox gig-comments-textbox-title" type="textbox" />']),n.templates.set("commentBox",['<div class="gig-comments-$rootClass">',"$closeIcon","$loginCanvas","$addComment","</div>"]),n.templates.set("loginCanvas",['<div id="${id}-loginCanvas" class="gig-comments-loginCanvas-container">$loginCanvasContent</div>']),n.templates.set("closeIcon",['<div onclick="$onCloseClicked" class="gig-comments-close-icon"></div>']),n.templates.set("providersCheckboxesContent",['<div class="gig-comments-providers gig-comments-$rootClass-providers">$drawProviders()&#160;</div>']),n.templates.set("providerCheckbox",['<div id="$id" class="gig-comments-checkbox gig-comments-$rootClass-checkbox" onclick="$onCheckboxClicked;return false;" style="$style">','<div id="$id-image" class="gig-comments-checkboxImage gig-comments-$rootClass-checkboxImage">\x3c!-- empty divs=100% height IE --\x3e</div>','<div class="gig-comments-checkboxProviderImage gig-comments-$rootClass-checkboxProviderImage" style="background-image:url(\'$iconURL\');"></div>',"</div>"]),n.templates.set("providerCheckbox-mobile",['<div id="$id" class="gig-comments-checkbox gig-comments-$rootClass-checkbox">','<input type="checkbox" id="$id-cb" class="gig-comments-checkboxProvider gig-comments-$rootClass-checkboxProvider" value="${post_to_provider}" onchange="$onCheckboxClicked;return false;" />','<label for="$id-cb" class="gig-comments-checkboxProvider gig-comments-$rootClass-checkboxProvider">${post_to_provider}</label>',"</div>"]),n.templates.set("addCommentTextarea",['<div class="gig-comments-textarea-wrapper gig-comments-$rootClass-textarea-wrapper"><div style="padding:5px"><textarea onmousedown="if (typeof event!=\'undefined\' && event.stopPropagationn) event.stopPropagation()" ontouchstart="if (typeof event!=\'undefined\' && event.stopPropagation) event.stopPropagation()" onkeyup="var c=gigya.pluginUtils.text.normalizeLinebreaks(this.value); if (c.length>=$maxLength) {this.value=c.substring(0,$maxLength);}" class="gig-comments-textarea gig-comments-$rootClass-textarea" id="$id-commentTextarea" ></textarea></div></div>']),n.templates.set("button",['<a href="#" class="gig-comments-button gig-comments-$id" onclick="$onClick;return false;">$text</a>']),n.templates.set("postButton",['<a href="#" class="gig-comments-button gig-comments-button-post gig-comments-$rootClass-button-post" onclick="$onPostButtonClicked;return false;">$post</a>']),n.templates.set("comments-header",['<div class="gig-comments-commentList-header">$comments_count</span> $rss</div>','<div class="gig-comments-updatesStripPlaceholder"></div>']),n.templates.set("commentsCountWrapper",['<div class="gig-comments-commentList-header gig-comments-commentList-header-commentsCount">$count</div>']),n.templates.set("rss",['<div class="gig-comments-headerLinks">','<a class="gig-comments-headerLinks-rss" rel="nofollow" href="$rssURL" type="application/rss+xml" title="RSS" onclick="return $onRssClick" oncontextmenu="$onRssRightClick">$rss_text</a>','<span class="gig-comments-vertical-seperator gig-comments-vertical-seperator-rss">|</span>','<a class="gig-comments-headerLinks-subscribe" href="#" title="$subscribe_text" onclick="$onSubscribeClick; return false;" id="$id-subscribeLink">$subscribe_text</a>',"</div>"]),n.templates.set("followLink",['<a class="gig-comments-follow" onclick="$onFollowClicked" id="$id-followLink"></a>']),n.templates.set("dottedLine",['<div class="gig-comments-dottedLine">\x3c!-- empty divs=100% height IE --\x3e</div>']),n.templates.set("comments-footer",['<div class="gig-comments-commentList-footer">$showMoreComments</div>']),n.templates.set("showMoreComments",['<div class="gig-comments-showMoreComments-container"><div onmouseover="this.className=\'gig-comments-showMoreComments gig-comments-showMoreComments-over\'" onmouseout="this.className=\'gig-comments-showMoreComments\'" class="gig-comments-showMoreComments" onclick="$onMoreCommentsClick"><div class="gig-comments-showMoreComments-text">${show_more_comments}</div></div></div>']),n.templates.set("showMoreComments-progress",['<div class="gig-comments-showMoreComments"><span><div class="gig-comments-showMoreComments-progress">&#160;</div></span></div>']),n.templates.set("flagDialog",['<div class="gig-comments-dialog gig-comments-dialog-flag">','<div class="gig-comments-dialog-caption gig-comments-dialog-caption-flag">',"$report_comment_to_site_owner",'<div class="gig-comments-dialog-closeIcon" onclick="$onClose"></div>',"</div>",'<div class="gig-comments-dialog-body gig-comments-dialog-body-flag">',"$are_you_sure_you_want_to_mark_this_comment_as_inappropriate",'<div class="gig-comments-dialog-buttons gig-comments-dialog-buttons-flag">','<a class="gig-comments-button gig-comments-button-cancel" onclick="${onCancel}; return false;" href="#">$cancel</a>','<a class="gig-comments-button gig-comments-button-flagThisComment" onclick="${onFlag}; return false;" href="#">$yes_flag_this_comment</a>',"</div>","</div>","</div>"]),n.templates.set("removeDialog",['<div class="gig-comments-dialog gig-comments-dialog-remove">','<div class="gig-comments-dialog-caption gig-comments-dialog-caption-remove">',"$delete_comment",'<div class="gig-comments-dialog-closeIcon" onclick="$onCancel"></div>',"</div>",'<div class="gig-comments-dialog-body gig-comments-dialog-body-remove">',"$are_you_sure",'<div class="gig-comments-dialog-buttons gig-comments-dialog-buttons-remove">','<a class="gig-comments-button gig-comments-button-cancel" onclick="${onCancel}; return false;" href="#">$no</a>','<a class="gig-comments-button gig-comments-button-remove" onclick="${onRemove}; return false;" href="#">$yes</a>',"</div>","</div>","</div>"]),n.templates.set("subscribeDialog",['<div class="gig-comments-dialog gig-comments-dialog-subscribe">','<div class="gig-comments-dialog-caption gig-comments-dialog-caption-subscribe">',"$notifications_settings",'<div class="gig-comments-dialog-closeIcon" onclick="$onCancel"></div>',"</div>",'<div class="gig-comments-dialog-body gig-comments-dialog-body-subscribe">','<div class="gig-comments-dialog-subscribe-enterYourEmail">${enter_your_email}</div>','<div class="gig-comments-dialog-subscribe-emailTextbox-container">','<input id="$textboxID" onkeyup="${onKeyUp}" type="textbox" class="gig-comments-textbox gig-comments-dialog-subscribe-emailTextbox" value="$defaultEmail" />',"</div>",'<a href="#" class="gig-comments-button gig-comments-button-subscribe" onclick="${onSubscribe};return false;" id="$buttonID">$subscribe_text</a>','<div class="gig-comments-dialog-subscribe-error" id="${errorPlaceholderID}" style="visibility:hidden">${please_provide_a_valid_email_address}</div>',"</div>","</div>"]),n.templates.set("confirmationDialog",['<div class="gig-comments-dialog gig-comments-dialog-confirmation">','<div class="gig-comments-dialog-caption gig-comments-dialog-caption-confirmation">',"$title",'<div class="gig-comments-dialog-closeIcon" onclick="$onCancel"></div>',"</div>",'<div class="gig-comments-dialog-body gig-comments-dialog-body-confirmation">',"$text","</div>","</div>"]),n.templates.set("moreProvidersDialog",['<div class="gig-comments-dialog gig-comments-dialog-moreProviders">','<div class="gig-comments-dialog-caption gig-comments-dialog-caption-moreProviders">',"$more_share_destinations",'<div class="gig-comments-dialog-smallCloseIcon" onclick="$onCancel"></div>',"</div>",'<div class="gig-comments-dialog-body gig-comments-dialog-body-moreProviders">',"$moreProvidersHTML","</div>","</div>"]),n.templates.set("moreProvider",['<a class="gig-comments-moreProvider" onclick="${onClick};return false;" style="background-image:url(\'${iconURL}\');background-position:left center;background-repeat:no-repeat;padding:0 ${iconWidth}">',"$providerName","</a>"]),n.templates.set("moreLink",['<a href="#" onclick="${onClick};return false;" class="gig-comments-more">$more</a>']),n.templates.set("myRating",["$loginCanvas",'<div class="gig-comments-myRating">','<div class="gig-comments-myRating-label">${myRatingLabel}</div> $rating',"</div>",'<div class="gig-comments-mySummary">','<div class="gig-comments-mySummary-label">${mySummaryLabel}</div>','<div class="gig-comments-mySummary-value">${summary}</div>',"</div>",'<div class="gig-comments-myReview">','<div class="gig-comments-myReview-label">${myReviewLabel}</div>','<div class="gig-comments-myReview-value">${review}</div>',"</div>"])}},s=n.getText,a=function(e,t){this.data=e,this.id=e.ID,this.parentID=e.parentID,this.children=e.children,this.timestamp=e.timestamp,this.commentText=e.commentText?e.commentText:"",this.commentTitle=e.commentTitle?e.commentTitle:"",this.ratings=e.ratings,this.username=e.sender.name,this.username||(this.username="Anonymous"),this.photoURL=e.sender.photoURL,this.UID=e.UID,this.threadTimestamp=e.threadTimestamp,this.provider=e.sender.loginProvider,this.status=e.status,this.isTemp=e.isTemp,this.isPost=e.isPost,e.providerPostIDs&&(this.providerPostIDs=e.providerPostIDs),this.posVotes=e.posVotes?e.posVotes:0,this.negVotes=e.negVotes?e.negVotes:0,this.vote=e.vote?e.vote:0,this.plugin=t,this.containerID=this.plugin.containerID+"_"+this.id,this.plugin.commentsInstances||(this.plugin.commentsInstances={}),this.plugin.commentsInstances[this.id]=this};a.prototype={id:null,parentID:null,plugin:null,children:null,level:null,childrenCount:null,timestamp:null,provider:null,providerPostIDs:null,containerID:null,getContainer:function(){return document.getElementById(this.containerID)},getParentComment:function(){return this.plugin.commentsInstances[this.parentID]},isRemovedComment:function(){return!this.isPost&&-1!=["rejected","deleted","pending"].indexOf(this.data.status)},isPostPending:function(){return this.isPost&&this.data&&"pending"==this.data.status},expandCollapse:function(){var e=document.getElementById("gig-replies-"+this.id);e&&("none"==e.style.display?this.expand():this.collapse())},expand:function(){var e=document.getElementById("gig-expand-"+this.id),t=document.getElementById("gig-replies-"+this.id);e&&t&&(e.className="gig-comments-expand-arrow",window.gigya.utils.DOM.showByID(t.id))},collapse:function(){var e=document.getElementById("gig-expand-"+this.id),t=document.getElementById("gig-replies-"+this.id);e&&t&&(e.className="gig-comments-collapse-arrow",window.gigya.utils.DOM.hideByID(t.id))},updateRepliesCount:function(){var e=this.plugin._templates.expand_collapse,t="reviews"==this.plugin.textMode?"one_comment":"one_reply",i="reviews"==this.plugin.textMode?"num_comments":"num_replies",o=s(1==this.childrenCount?t:i,"%num",this.childrenCount||0);"fr"==this.plugin._p.lang&&"0"==this.childrenCount&&(o=s(t,"%num",this.childrenCount).replace("1","0"));var n={commentID:this.id,onExapndCollapse:this.getRefString()+".expandCollapse()",replies_count:o};document.getElementById("gig-comments-comment-"+this.id+"-repliesCountPlaceholder").innerHTML=this.childrenCount>0?window.gigya.utils.templates.fill(e,n):"";var a=this.getParentComment();a&&a.updateRepliesCount()},getCommentElementByClass:function(e){return window.gigya.utils.DOM.getElementsByClass(this.getContainer(),"gig-comments-comment-"+e)[0]},markAsNew:function(){var e=this.getCommentElementByClass("newIndicator");e&&(e.style.display="")},unmarkAsNew:function(){var e=this.getCommentElementByClass("newIndicator");e&&(e.style.display="none")},closeReplybox:function(){document.getElementById(this.plugin.containerID+"-reply-"+this.id).innerHTML="",document.getElementById(this.plugin.containerID+"-reply-"+this.id).style.display="none",document.getElementById(this.plugin.containerID+"-replybutton-"+this.id).className="gig-comments-button gig-comments-button-reply",this.plugin.lastReplyId=null;var e=document.getElementById(this.plugin.containerID+"-reply-"+this.id+"-guestUI");e&&e.parentNode&&e.parentNode.removeChild(e);var t=document.getElementById(this.plugin.containerID+"-reply-"+this.id+"-login");t&&t.parentNode&&t.parentNode.removeChild(t)},showFlagDialog:function(){if(this.plugin.lastFlagComment&&this.plugin.lastFlagComment.hideFlagDialog(),!this.data.flagged){this.plugin.lastFlagComment=this,document.getElementById("gig-flag-"+this.id).style.visibility="visible";var e="reviews"==this.plugin.textMode&&0==this.level?"review":"comment",t=this.plugin._templates.flagDialog,i={report_comment_to_site_owner:s("report_"+e+"_to_site_owner"),are_you_sure_you_want_to_mark_this_comment_as_inappropriate:s("are_you_sure_you_want_to_mark_this_"+e+"_as_inappropriate"),cancel:s("cancel"),yes_flag_this_comment:s("yes_flag_this_"+e),onClose:this.getRefString()+".hideFlagDialog()",onCancel:this.getRefString()+".hideFlagDialog()",onFlag:this.getRefString()+".flag()"},o=this.plugin.containerID+"-"+this.id+"-flag",n=window.gigya.utils.DOM.createTopLevelDiv(o+"_container");n.style.position="absolute",n.className="gig-comments-container",n.innerHTML=window.gigya.utils.templates.fill(t,i),window.gigya.utils.DOM.setSize(n,400,150,!0)}},hideFlagDialog:function(e){e||(document.getElementById("gig-flag-"+this.id).style.visibility="");var t=document.getElementById(this.plugin.containerID+"-"+this.id+"-flag_container");t&&t.parentNode.removeChild(t)},showRemoveDialog:function(){if(this.data.sender.isSelf){var e="reviews"==this.plugin.textMode&&0==this.level?"review":"comment",t=this.plugin._templates.removeDialog,i={are_you_sure:s("are_you_sure_you_want_to_permanently_delete_your_"+e+"_qm"),no:s("no"),yes:s("yes"),onCancel:this.getRefString()+".hideRemoveDialog()",onRemove:this.getRefString()+".remove()",delete_comment:s("delete_"+e)},o=this.plugin.containerID+"-"+this.id+"-remove",n=window.gigya.utils.DOM.createTopLevelDiv(o+"_container");n.style.position="absolute",n.className="gig-comments-container",n.innerHTML=window.gigya.utils.templates.fill(t,i),window.gigya.utils.DOM.setSize(n,390,150,!0)}},hideRemoveDialog:function(){var e=document.getElementById(this.plugin.containerID+"-"+this.id+"-remove_container");e&&e.parentNode.removeChild(e)},markAsFlagged:function(){this.data.flagged=!0;var e=document.getElementById("gig-flag-"+this.id);e&&(e.className="gig-comments-comment-flag-submitted"),this.plugin._state.flags[this.id]=!0},remove:function(){window.gigya.comments.deleteComment(this.plugin._p,{commentID:this.id});for(var e=this.getParentComment(),t=0;t<this.plugin._commentsRawData.length;t++)if(this.plugin._commentsRawData[t].ID==this.id){this.plugin._commentsRawData.splice(t,1);break}for(;e;)e.childrenCount--,e.updateRepliesCount(),e=e.getParentComment();"reviews"==this.plugin.textMode&&0!=this.level||this.plugin._commentCount--,this.plugin.updateCount();var i=this.getContainer();i&&(this.childrenCount&&this.childrenCount>0?(this.data.status="deleted",this.data.commentText="",i.innerHTML=this.getHTML()):i.parentNode.removeChild(i));if(this.hideRemoveDialog(),this.plugin._userComments)for(t=0;t<this.plugin._userComments.length;t++)if(this.plugin._userComments[t].ID==this.id){this.plugin._userComments.splice(t,1);break}"reviews"==this.plugin.textMode&&this.plugin._drawCommentBox()},voteUp:function(){"pos"==this.vote?this.setVote("none"):this.setVote("pos")},voteDown:function(){"neg"==this.vote?this.setVote("none"):this.setVote("neg")},setVote:function(e){var t=this;if(this.plugin._user&&this.plugin._user.isConnected){switch(this.voteInProgress=!0,window.gigya.comments.vote(this.plugin._c,{vote:e,commentID:this.id,callback:function(){t.voteInProgress=!1}}),e){case"pos":this.posVotes++;break;case"neg":this.negVotes++}switch(this.vote){case"pos":this.posVotes--;break;case"neg":this.negVotes--}this.vote=e,this.updateVoteUI();var i={eventName:"commentVoted",categoryID:this.plugin._p.categoryID,streamID:this.plugin._p.streamID,comment:this.data,vote:e,mode:this.plugin.textMode};this.data.vote=this.vote,this.data.posVotes=this.posVotes,this.data.negVotes=this.negVotes,window.gigya.events.dispatchForWidget(i,this.plugin._p),(i=window.gigya.utils.object.clone(i)).eventName="commentVote",window.gigya.events.dispatchForWidget(i,this.plugin._p)}else{var o="pos"==e?"gig-voteUp-"+this.id:"gig-voteDown-"+this.id;this.plugin.loginClicked(this.id+"-vote-"+e,document.getElementById(o),function(){t.setVote(e)},!0)}},loginClicked:function(e){this.plugin.loginClicked(this.id,e)},updateVoteUI:function(){var e=document.getElementById("gig-vote-"+this.id);e&&e.originalHTML&&(e.innerHTML=e.originalHTML),this.plugin._user&&this.plugin._user.isConnected||(this.vote="none");var t,i=document.getElementById("gig-voteUp-"+this.id),o=document.getElementById("gig-voteDown-"+this.id),n=document.getElementById("gig-voteValue-"+this.id),s=document.getElementById("gig-voteValuePos-"+this.id),a=document.getElementById("gig-voteValueNeg-"+this.id);switch(this.vote){case"pos":i&&(i.className="gig-comments-button gig-comments-button-down gig-comments-button-vote gig-comments-button-vote-up"),o&&(o.className="gig-comments-button gig-comments-button-vote gig-comments-button-vote-down");break;case"neg":i&&(i.className="gig-comments-button gig-comments-button-vote gig-comments-button-vote-up"),o&&(o.className="gig-comments-button gig-comments-button-down gig-comments-button-vote gig-comments-button-vote-down");break;case"none":default:i&&(i.className="gig-comments-button gig-comments-button-vote gig-comments-button-vote-up"),o&&(o.className="gig-comments-button gig-comments-button-vote gig-comments-button-vote-down")}n&&((t=this.posVotes-this.negVotes)>0&&(t="+"+t),(isNaN(t)||0==t)&&(t="0"),n.innerHTML=t);s&&((t=this.posVotes)&&(t=t),(isNaN(t)||0==t)&&(t="0"),s.innerHTML=t);a&&((t=this.negVotes)&&(t=t),(isNaN(t)||0==t)&&(t="0"),a.innerHTML=t)},flag:function(){window.gigya.comments.flagComment(this.plugin._c,{commentID:this.id}),this.hideFlagDialog(!0),this.markAsFlagged(),this.plugin.saveState()},listenForCombination:function(e){if(!e)e=window.event;if(40==e.keyCode&&e.shiftKey){var t=window.gigya.utils.stringUtils.format('<div class="gig-comments-container">Stream ID: {0}<br />Comment ID: {1}</div>',this.plugin._p.streamID,this.id);window.gigya.global.putGMBalloonNextTo(this.getContainer(),t,"Comment Data",400,100),e.preventDefault&&e.preventDefault()}},mouseOver:function(){var e=this;if(!this.plugin.isMobileUI){if(this.keydownDelegate||(this.keydownDelegate=function(t){return e.listenForCombination(t)}),document.attachEvent?document.attachEvent("onkeydown",this.keydownDelegate):window.addEventListener&&window.addEventListener("keydown",this.keydownDelegate,!1),!this.data.flagged){var t=document.getElementById("gig-flag-"+this.id);t&&(t.className="gig-comments-comment-flag gig-comments-comment-flag-over")}if(this.plugin._settings.allowCommentDeletion&&this.data.sender.isSelf&&!this.plugin._user.isGuest){var i=document.getElementById("gig-remove-"+this.id);i&&(i.className="gig-comments-comment-remove gig-comments-comment-remove-over")}}},mouseOut:function(){try{window.detachEvent?document.detachEvent("onkeydown",this.keydownDelegate):window.removeEventListener&&window.removeEventListener("keydown",this.keydownDelegate,!1)}catch(e){}if(!this.data.flagged){var e=document.getElementById("gig-flag-"+this.id);e&&(e.className="gig-comments-comment-flag")}if(this.plugin._settings.allowCommentDeletion&&this.data.sender.isSelf&&!this.plugin._user.isGuest){var t=document.getElementById("gig-remove-"+this.id);t&&(t.className="gig-comments-comment-remove")}},getHTML:function(){var e=this.commentText.replace(/\$/g,"&#36;");e=window.gigya.global.wbr(e,15).replace(/\n/g,"<br />");var t=window.gigya.global.getPhotoURL(this.photoURL);t&&""!=t||(t=i+"avatar_32x32.gif");var o="reviews"==this.plugin.textMode?"one_comment":"one_reply",a="reviews"==this.plugin.textMode?"num_comments":"num_replies",m=s(1==this.childrenCount?o:a,"%num",this.childrenCount||0);"fr"==this.plugin._p.lang&&"0"==this.childrenCount&&(m=s(o,"%num",this.childrenCount).replace("1","0"));var g=this.isRemovedComment()?s("anonymous"):this.username,r=this.plugin.isMobileUI?10:42,l={id:this.plugin.containerID,commentID:this.id,newText:s("new"),photoDiv:this.plugin._templates.photoDiv32,replyButton:this.plugin._templates.replyButton,reply:"reviews"==this.plugin.textMode?s("comment"):s("reply"),onReplyClicked:this.plugin.getRefString()+".replyClicked('"+this.id+"')",classname:this.parentID&&0!=this.parentID?"comment-child":"comment",rootClass:"comment",paddingLeft:this.level*r+"px",childComments:n.drawComments(this.children,this.plugin,this.level+1),photoURL:t,body:e,username:window.gigya.utils.sanitize.sanitizeHTML(window.gigya.global.wbr(g,20)).replace(/\$/g,"&#36;"),mediaItemPlaceholder:this.plugin._templates.mediaItemPlaceholder,mediaItemURL:this.data.mediaItems&&this.data.mediaItems.length>0?this.data.mediaItems[0].url:"",commentReplyPlaceholder:this.plugin._templates.replyPlaceholder,errorPlaceholder:this.plugin._templates.errorPlaceholder,moderatorEditTextPlaceholder:this.data.moderatorEdit?this.plugin._templates.moderatorEditTextPlaceholder:"",outstandingBadgePlaceholder:10==this.data.moderatorRating?this.plugin._templates.outstandingBadgePlaceholder:"",moderatorEditText:"reviews"==this.plugin.textMode?s("review_edited_by_a_moderator"):s("comment_edited_by_a_moderator"),dottedLine:"",repliesCountPlaceholder:this.plugin._templates.repliesCountPlaceholder,replies_count:m,expand_collapse:"",userImage:this.plugin._templates.userImage,providerImage:"",comment:this.plugin._templates.comment,flag:"",vote:"",remove:"",onVoteUpClick:this.getRefString()+".voteUp()",onVoteDownClick:this.getRefString()+".voteDown()",onFlagClicked:this.getRefString()+".showFlagDialog()",onRemoveClicked:this.getRefString()+".showRemoveDialog()",onmouseover:this.getRefString()+".mouseOver()",onmouseout:this.getRefString()+".mouseOut()",ratings:"",title:this.commentTitle&&!this.isRemovedComment()?this.commentTitle:"",titlePlaceholder:this.commentTitle?this.plugin._templates.titlePlaceholder:""};if(10==this.data.moderatorRating&&(l.classname+=" gig-comments-comment-outstanding"),this.ratings&&!this.isRemovedComment()){var d=this.plugin._templates.rating;l.starClassName="gig-comments-star",l.ratings=window.gigya.utils.templates.fill(d,{ratingID:"overall",value:this.ratings._overall})}if(l.width=this.plugin._p.width-this.level*r+"px",l.marginLeft=this.level*r+10*(this.level-1),l.marginLeft<0&&(l.marginLeft=0),this.data.fromFacebook&&(l.classname+=" gig-comments-comment-facebook",l.comment=this.plugin._templates.facebookComment),!this.plugin._settings.enableFlagging||this.isTemp||this.isPostPending()||this.isRemovedComment()||(l.flag=this.plugin._templates.flag),l.remove=this.plugin._templates.remove,!this.plugin._settings.enableVoting||this.isTemp||this.isPostPending()||this.isRemovedComment()||(l.vote=window.gigya.utils.templates.fill(this.plugin._templates.vote,{commentID:this.id,allowNegativeVoting:this.plugin._settings.allowNegativeVoting,displayPosNegVotes:this.plugin._settings.displayPosNegVotes})),("readOnly"==this.plugin.streamInfo.status||"disabled"==this.plugin._settings.enableCommentBody||this.isRemovedComment())&&(l.replyButton=""),this.provider){var c=window.gigya.socialize._getProviderByName(this.provider);c&&6002!=c.ID&&(l.providerImage=this.plugin._templates.providerImage,l.providerImageURL=i+"providers/"+this.provider+"User_14x14.gif")}0==this.level&&(l.paddingLeft="0px",l.dottedLine=this.plugin._templates.dottedLine),this.level+1>this.plugin._settings.threadingDepth&&(l.replyButton=""),this.children&&this.children.length>0&&(l.expand_collapse=this.plugin._templates.expand_collapse,l.onExapndCollapse=this.getRefString()+".expandCollapse()");var u=(new Date).getTime();(new Date).setTime(this.timestamp);var p=(u-this.timestamp)/1e3/60/60;this.isRemovedComment()?l.dateString="":l.dateString=60*p<1?s("less_than_a_minute_ago"):p<1?1==Math.round(60*p)?s("one_minute_ago"):s("num_minutes_ago","%num",Math.round(60*p)):p<24?1==Math.round(p)?s("one_hour_ago"):s("num_hours_ago","%num",Math.round(p)):1==Math.round(p/24)?s("one_day_ago"):s("num_days_ago","%num",Math.round(p/24));var h=this.plugin._templates.commentContainer;return l.commentContainerId=this.containerID,(this.isTemp||this.isPostPending()||this.isRemovedComment())&&(l.replyButton=""),this.isPostPending()?(l.comment=this.plugin._templates.pendingComment,l.awaiting_moderation_text="reviews"==this.plugin.textMode&&0==this.level?s("your_review_is_awaiting_moderation"):s("your_comment_is_awaiting_moderation")):this.isRemovedComment()&&(l.comment=this.plugin._templates.pendingComment,"pending"==this.status?l.awaiting_moderation_text="reviews"==this.plugin.textMode&&0==this.level?s("this_review_is_awaiting_moderation"):s("this_comment_is_awaiting_moderation"):l.awaiting_moderation_text="reviews"==this.plugin.textMode&&0==this.level?s("this_review_has_been_deleted"):s("this_comment_has_been_deleted")),window.gigya.utils.templates.fill(h,l)},getRefString:function(){return this.plugin.getRefString()+".commentsInstances['"+encodeURIComponent(this.id)+"']"}},o.prototype={_comments:null,_user:null,_settings:null,_state:null,_lastCommentTimestamp:null,_previousLastCommentTimestamp:null,_refreshTimeout:null,_p:null,_container:null,_isPaused:null,_templates:{},saveState:function(){window.gigya.utils.localStorage.setObject("gig-comments",this._state)},loadState:function(){this._state=window.gigya.utils.localStorage.getObject("gig-comments",{flags:{}})},loadTemplates:function(e){this._templates=n.templates.getMapCopy(),e&&(null!=e.loginCanvas_loggedOut&&null==e.loginCanvas_loggedOutWithGuest&&(e.loginCanvas_loggedOutWithGuest=e.loginCanvas_loggedOut,e.loginCanvas_loggedOut_mobile=e.loginCanvas_loggedOut),this._templates=window.gigya.utils.object.merge([this._templates,e]),this._p.ctag+="_templates")},checkForNewComments:function(){var e=this;"off"==this._settings.refreshMode||this._isPaused||window.gigya.comments.getStreamInfo(this._p,{callback:function(t){if(t.streamInfo){var i="reviews"==e.textMode?t.streamInfo.ratingCount:t.streamInfo.commentCount,o=i-e._commentCount;o>0&&(e._lastCommentTimestamp=t.streamInfo.lastCommentTimestamp,e._newCommentsCount=(e._newCommentsCount||0)+o,e.onHasNewComments("countOnly"==e._settings.refreshMode?o:e._newCommentsCount,i))}}})},onHasNewComments:function(e,t){var i=this,o=this._settings.refreshMode,n=this._templates.updatesStrip,a=this.getElementByCommentsClass("updatesStripPlaceholder");"countOnly"==o?(a.style.visibility="",a.innerHTML=window.gigya.utils.templates.fill(n,{text:1==e?s("1_new_comment_was_recently_posted"):s("num_new_comments_were_recently_posted","%num",e),linkText:s("click_to_show")}),window.gigya.utils.DOM.addEventListener(this.getElementByCommentsClass("updatesStrip-link"),"click",function(){i.getNewComments(),i._commentCount=t,a.style.visibility="hidden"})):"full"==o&&(this.getNewComments(),this._commentCount=t,a.innerHTML=window.gigya.utils.templates.fill(n,{text:1==e?s("1_comment_was_recently_added"):s("num_comments_were_recently_added","%num",e),linkText:s("pause_stream")}),window.gigya.utils.DOM.addEventListener(this.getElementByCommentsClass("updatesStrip-link"),"click",function(){i._isPaused=!i._isPaused,this.innerHTML=i._isPaused?s("resume_stream"):s("pause_stream")}))},getElementByCommentsClass:function(e){return window.gigya.utils.DOM.getElementsByClass(this.container,"gig-comments-"+e)[0]},getNewComments:function(){this._getComments(!0)},_getComments:function(e){var t=this,i=window.gigya.utils.object.removeUndefined({categoryID:this._p.categoryID,streamID:this._p.streamID,includeSettings:!0,includeUserOptions:!0,threaded:!1,tags:this._p.filterTags});t.nopaging&&(i.threadLimit=0),t._next?e||(i.start=t._next):i.includeStreamInfo=!0,e&&this.streamInfo&&this.streamInfo.lastCommentTimestamp&&(i.since=this.streamInfo.lastCommentTimestamp),i.callback=function(o){if(0!=o.errorCode)t.broadcastedError||(t.container&&!t._next&&(t.container.innerHTML=""),window.gigya.events.dispatchErrorFromResponse(t._p,o),t.broadcastedError=!0);else{o.settings&&(t._settings=o.settings),t._settings||(t._settings={}),o.userComments&&(t._userComments=o.userComments),t.textMode="ratingsOnly"==t._settings.mode||"reviews"==t._settings.mode?"reviews":"comments";if(i.start?t._commentsRawData=t._commentsRawData.concat(o.comments):t._commentsRawData=e?o.comments.concat(t._commentsRawData):o.comments,t._hasMore=o.hasMore,o.streamInfo&&(t.streamInfo=o.streamInfo,t._commentCount="reviews"==t.textMode?o.streamInfo.ratingCount:o.streamInfo.commentCount,t._lastCommentTimestamp=o.streamInfo.lastCommentTimestamp),o.userOptions&&(t.userOptions=o.userOptions),null!=t._p.useSiteLogin&&(t._settings.useSiteLogin=t._p.useSiteLogin),t._settings.useSiteLogin=window.gigya.utils.validation.isExplicitTrue(t._settings.useSiteLogin),t._comments=n.buildCommentsTree(t._commentsRawData,o.settings.sortBy,t,!1),t._next)t.drawNewComments(t._comments,e);else{"bottom"==t._settings.newCommentPosition?document.getElementById(t.containerID).innerHTML='<div id="'+t.containerID+'-comments-header"></div><div class="gig-commentList" id="'+t.containerID+'-comments"></div><div id="'+t.containerID+'-comments-footer"></div><div class="gig-comments-separator"></div><div class="gig-comments-commentBox-bottom" id="'+t.containerID+'-commentBox"></div>':document.getElementById(t.containerID).innerHTML='<div id="'+t.containerID+'-commentBox"></div><div id="'+t.containerID+'-comments-header"></div><div class="gig-commentList" id="'+t.containerID+'-comments"></div><div id="'+t.containerID+'-comments-footer"></div>';var s=t._settings.refreshMode,a=t._settings.refreshInterval?1e3*t._settings.refreshInterval:0;a>0&&"off"!=s&&(this._refreshTimeout=window.setInterval(function(){t.checkForNewComments()},a)),t.redraw()}e||(t._next=o.next),t._drawFooter()}},window.gigya.comments.getComments(this._c,i)},getMoreComments:function(){var e=this._templates["showMoreComments-progress"];document.getElementById(this.containerID+"-comments-footer").innerHTML=window.gigya.utils.templates.fill(e,{id:this.containerID}),this._getComments()},_drawFooter:function(){var e=this._templates["comments-footer"],t={id:this.containerID,showMoreComments:"",onMoreCommentsClick:this.getRefString()+".getMoreComments()"};this._hasMore&&((new Image).src=i+"progress_ani.gif",t.showMoreComments=this._templates.showMoreComments,t.show_more_comments="reviews"==this._settings.mode?s("show_more_reviews"):"ratingsOnly"==this._settings.mode?s("show_more_ratings"):s("show_more_comments"));document.getElementById(this.containerID+"-comments-footer").innerHTML=window.gigya.utils.templates.fill(e,t)},_drawHeader:function(){var e=this._templates["comments-header"],t={id:this.containerID,comments_count:this._settings.disableCommentsCount?"":window.gigya.utils.templates.fill(this._templates.commentsCountWrapper,{}),rss:this._settings.disableRSS||this.isMobileUI?"":this._templates.rss,rss_text:s("rss"),subscribe_text:s("subscribe"),category_id:this._p.categoryID?this._p.categoryID:0,stream_id:this._p.streamID?encodeURIComponent(this._p.streamID):0,rssURL:this.streamInfo.rssURL,onRssClick:this.getRefString()+".onRssClick(true)",onSubscribeClick:this.getRefString()+".onSubscribeClick()",onRssRightClick:this.getRefString()+".onRssClick()"};document.getElementById(this.containerID+"-comments-header").innerHTML=window.gigya.utils.templates.fill(e,t),this.updateSubscribeUI(),this.updateCount()},onRssClick:function(e){if(e)return this.setStreamInfoIfNeeded(this.streamInfo.rssURL);this.setStreamInfoIfNeeded()},onSubscribeClick:function(){var e=this,t=function(t){return e.onUnsubscribe(t)};if(this.streamInfo.isUserSubscribed)window.gigya.comments.unsubscribe(this._c,{callback:t});else if(this.unsubscribeToken)window.gigya.comments.unsubscribe(this._c,{unsubscribeToken:this.unsubscribeToken,callback:t});else{var i="reviews"==this.textMode?"review":"comment";this.showSubscribeDialog(s("enter_your_email_to_subscribe_to_new_"+i+"s_in_this_stream_colon"),s("subscribe"),this.getRefString()+".subscribe")}},onFollowClicked:function(){if(this.userOptions&&"immediate"==this.userOptions.replyNotifications)this.unfollow();else{var e="reviews"==this.textMode?"review":"comment",t=s("review"==e?"enter_your_email_to_receive_notifications_when_someone_replies_to_your_comments_colon":"enter_your_email_to_receive_notifications_when_someone_replies_to_your_"+e+"s_colon");this.showSubscribeDialog(t,s("follow"),this.getRefString()+".follow")}},updateFollowStatus:function(){var e=this;window.gigya.comments.getUserOptions(this._c,{callback:function(t){403005==t.errorCode&&(t.userOptions={}),t.userOptions&&(e.userOptions=t.userOptions,e.updateFollowUI())}})},updateFollowUI:function(){var e=document.getElementById(this.containerID+"-followLink");if(e)if(!this._user.isConnected&&!this._user.isGuest||this._user.isTempUser)e.style.display="none";else{var t=this.userOptions&&"immediate"==this.userOptions.replyNotifications;e.className=t?"gig-comments-follow gig-comments-following":"gig-comments-follow",e.style.display="",e.title=t?"":"reviews"==this.textMode?s("notify_me_when_someone_comments_on_my_review"):s("notify_me_when_someone_replies_to_my_comments"),e.innerHTML=t?s("following"):"reviews"==this.textMode?s("follow_replies_to_my_reviews"):s("follow_replies_to_my_comments"),e.onmouseover=t?function(){t&&(this.innerHTML=s("unfollow")),this.className="gig-comments-follow gig-comments-unfollow"}:null,e.onmouseout=t?function(){t&&(this.innerHTML=s("following")),this.className="gig-comments-follow gig-comments-following"}:null}},follow:function(e){var t=document.getElementById(this.containerID+"_subscribeTextbox");!e&&t&&(e=t.value),this.hideSubscribeDialog(),window.gigya.comments.setUserOptions(this._c,{replyNotifications:"immediate",notificationsEmail:e,notificationsLanguage:this._c.lang}),this.userOptions||(this.userOptions={}),this.userOptions.replyNotifications="immediate",this.updateFollowUI()},unfollow:function(){window.gigya.comments.setUserOptions(this._c,{replyNotifications:"disabled"}),this.userOptions.replyNotifications="disabled",this.updateFollowUI()},showSubscribeDialog:function(e,t,i){this.hideSubscribeDialog();var o=this._templates.subscribeDialog,n={notifications_settings:s("notifications_settings"),enter_your_email:e,subscribe_text:t,onCancel:this.getRefString()+".hideSubscribeDialog()",onSubscribe:this.getRefString()+".onSubscribeOK("+i+")",please_provide_a_valid_email_address:s("please_provide_a_valid_email_address"),textboxID:this.containerID+"_subscribeTextbox",buttonID:this.containerID+"_subscribeTextboxButton",errorPlaceholderID:this.containerID+"_subscribeErrorPlaceholder",onKeyUp:this.getRefString()+".subscribeEmailKeyUp(event)",bodyID:this.containerID+"_subscribeBody",defaultEmail:this._user.email?this._user.email:""},a=this.containerID+"-subscribe",m=window.gigya.utils.DOM.createTopLevelDiv(a+"_container");m.style.position="absolute",m.className="gig-comments-container",m.innerHTML=window.gigya.utils.templates.fill(o,n),window.gigya.utils.DOM.setSize(m,390,m.offsetHeight,!0)},onSubscribeOK:function(e){var t=document.getElementById(this.containerID+"_subscribeTextbox");if(window.gigya.pluginUtils.validation.isEmailValid(t.value))e.apply(this);else{var i=document.getElementById(this.containerID+"_subscribeErrorPlaceholder");i&&(i.style.visibility=""),t.focus&&t.focus()}},hideSubscribeDialog:function(){var e=document.getElementById(this.containerID+"-subscribe_container");e&&e.parentNode.removeChild(e)},subscribeEmailKeyUp:function(e){document.getElementById(this.containerID+"_subscribeTextbox");var t,i=document.getElementById(this.containerID+"_subscribeErrorPlaceholder");i&&(i.style.visibility="hidden"),t=e&&e.which?(e=e).which:(e=event).keyCode;var o=document.getElementById(this.containerID+"_subscribeTextboxButton");13==t&&o&&o.onclick()},showConfirmationDialog:function(e,t){var i=this,o=this._templates.confirmationDialog,n={text:t,title:e,onCancel:this.getRefString()+".hideConfirmationDialog()"},s=this.containerID+"-confirmation",a=window.gigya.utils.DOM.createTopLevelDiv(s+"_container");a.style.position="absolute",a.className="gig-comments-container",a.innerHTML=window.gigya.utils.templates.fill(o,n),window.gigya.utils.DOM.setSize(a,390,150,!0),window.setTimeout(function(){i.hideConfirmationDialog()},3e3)},hideConfirmationDialog:function(){var e=document.getElementById(this.containerID+"-confirmation_container");e&&e.parentNode.removeChild(e)},subscribe:function(){var e=document.getElementById(this.containerID+"_subscribeTextbox");if(e){var t=this;window.gigya.comments.subscribe(this._c,{email:e.value,callback:function(e){t.onSubscribe(e)}}),this.hideSubscribeDialog();var i="reviews"==this.textMode&&0==this.level?"review":"comment",o='<div class="gig-comments-dialog-subscribe-okIcon"></div>'+s("thank_you_for_subscribing")+"<br />"+s("new_"+i+"s_will_be_sent_directly_to_your_email_inbox");this.showConfirmationDialog(s("notifications_settings"),o)}},updateSubscribeStatus:function(){if(!this._settings.disableRSS){var e=this;this._user.isConnected?window.gigya.comments.getStreamInfo(this._c,{callback:function(t){t.streamInfo&&(e.streamInfo=t.streamInfo,e.updateSubscribeUI())}}):(e.streamInfo.isUserSubscribed=!1,e.updateSubscribeUI())}},updateSubscribeUI:function(){var e=document.getElementById(this.containerID+"-subscribeLink");if(e){var t=this.streamInfo.isUserSubscribed||this.unsubscribeToken?s("unsubscribe"):s("subscribe");e.title=e.innerHTML=t}},onSubscribe:function(e){e&&e.unsubscribeToken&&(this.unsubscribeToken=e.unsubscribeToken),e.unsubscribeToken||(this.streamInfo.isUserSubscribed=!0),this.updateSubscribeUI()},onUnsubscribe:function(e){0==e.errorCode&&(this.showConfirmationDialog(s("notifications_settings"),s("you_have_successfully_unsubscribed")),delete this.unsubscribeToken,this.streamInfo.isUserSubscribed=!1,this.updateSubscribeUI())},setStreamInfoIfNeeded:function(e){var t=this._p.streamTitle;t||(t=document.title),t&&""!=t||(t="Site");var i=this._p.streamURL;i||(i=document.location.href);var o=this;return!(!this.streamInfo.streamURL||this._p.streamInfoSig&&(t!=this.streamInfo.streamTitle||i!=this.streamInfo.streamURL))||(window.gigya.comments.setStreamInfo(this._c,{streamTitle:t,streamURL:i,callback:function(){o.streamInfo.streamTitle=t,o.streamInfo.streamURL=i,e&&(document.location=e)}}),!1)},_drawComments:function(){this.lastReplyId=null,this._drawHeader(),this._drawFooter();var e=n.drawComments(this._comments,this);for(var t in document.getElementById(this.containerID+"-comments").innerHTML=e,this.commentsInstances){var i=this.commentsInstances[t];this._settings.repliesCollapsed&&i.collapse(),this._state&&this._state.flags&&this._state.flags[t]&&i.markAsFlagged(),i.updateVoteUI()}},logout:function(){window.gigya.socialize.logout(this._c,{context:this._p.context})},guestLogout:function(){var e=document.getElementById(this.containerID+"-login");e&&e.parentNode.removeChild(e),document.cookie="_gig_comments_email=x;expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/",document.cookie="_gig_comments_nickname=x;expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/",this._user={UID:""},this._updateUserInfo()},guestClicked:function(e){var t=document.getElementById(e+"-guestUI");if(null!=t);else{var i=document.getElementById(e+"-guestDropdown");(t=document.createElement("div")).id=e+"-guestUI";var o=window.gigya.global._GetElementPos(i);t.style.left=(window.gigya.localInfo.quirksMode?o.left-2:o.left)+"px",t.style.top=o.top+i.offsetHeight-2+(window.gigya.localInfo.quirksMode?-2:0)+"px",t.className="gig-comments-container gig-comments-guestUI";var n=this._templates.guestBox,a={id:e+"-guestUI",nickname:s("nickname"),email:window.gigya.utils.sanitize.sanitizeAttribute(this._settings.isGuestEmailRequired?s("email"):s("email_optional")),ok:s("ok"),email_not_displayed_publicly:s("email_not_displayed_publicly"),okButton:this._templates.okButton,guestErrorPlaceholder:this._templates.guestErrorPlaceholder,nicknameTextbox:this._templates["guest-nicknameTextbox"],emailTextbox:this._templates["guest-emailTextbox"],onGuestLogin:this.getRefString()+".guestLoginClicked('"+e+"-guestUI')"};t.innerHTML=window.gigya.utils.templates.fill(n,a),document.body.appendChild(t),t.fncHide=function(e){if(e){if(e.target&&-1!=e.target.id.indexOf(t.id))return;if(e.srcElement&&-1!=e.srcElement.id.indexOf(t.id))return}i.className="gig-comments-dropdown gig-comments-dropdown-guest",document.attachEvent?document.detachEvent("onclick",t.fncHide):document.addEventListener&&document.removeEventListener("click",t.fncHide,!1),t&&t.parentNode&&t.parentNode.removeChild(t),t=null},t.fncShow=function(){i.className="gig-comments-dropdown gig-comments-dropdown-guest gig-comments-dropdown-down gig-comments-dropdown-guest-down",window.setTimeout(function(){document.attachEvent?document.attachEvent("onclick",t.fncHide):document.addEventListener&&document.addEventListener("click",t.fncHide,!1)},50)},t.fncShow()}},getCommentByID:function(e){if(this.commentsInstances)return this.commentsInstances[e]},onRatingClick:function(e){var t=e.getAttribute("gig-baseid"),i=e.getAttribute("gig-ratingID");this.selectedRatings||(this.selectedRatings={}),this.selectedRatings[i]={value:e.getAttribute("gig-rating"),details:this.isMobileUI?"":e.getAttribute("gig-rating-details"),baseID:t},e.onmouseout(e),this.validatePost(null,!0)},onRatingMouseOver:function(e){if(!this.isMobileUI){for(var t=e.getAttribute("gig-rating"),i=e.getAttribute("gig-baseid"),o=0;o<5;o++){var n=document.getElementById(i+"_"+o);n&&(n.className=o<t?"gig-comments-star-editable-empty gig-comments-star-editable-full":"gig-comments-star-editable-empty")}var s=document.getElementById(e.getAttribute("gig-baseid")+"_details");s&&(s.innerHTML=e.getAttribute("gig-rating-details"))}},onRatingMouseOut:function(e){e.getAttribute("gig-rating");for(var t=e.getAttribute("gig-baseid"),i=e.getAttribute("gig-ratingID"),o=0;o<5;o++){var n=document.getElementById(t+"_"+o);n&&(this.selectedRatings&&this.selectedRatings[i]&&o<this.selectedRatings[i].value?n.className="gig-comments-star-editable gig-comments-star-editable-full":n.className="gig-comments-star-editable")}var s=document.getElementById(e.getAttribute("gig-baseid")+"_details");s&&(this.selectedRatings&&this.selectedRatings[i]?s.innerHTML=this.selectedRatings[i].details:s.innerHTML="")},clearRatings:function(){for(var e in this.selectedRatings){for(var t=this.selectedRatings[e].baseID,i=0;i<5;i++){var o=document.getElementById(t+"_"+i);o&&(o.className="gig-comments-star-editable")}var n=document.getElementById(t+"_details");n&&(n.innerHTML="")}this.selectedRatings={}},validatePost:function(e,t){var i=this.containerID;e&&(i=this.containerID+"-reply-"+e);var o=document.getElementById(i+"-validationError");if(!t||!o||"none"!=o.style.display&&""!=o.style.display){var n,a=this,m=function(){a.validatePost(e)},g=document.getElementById(i+"-commentTextarea"),r=document.getElementById(i+"-titleTextbox"),l=document.getElementById(i+"_rating__overall"),d=!0;return g&&(g.parentNode.parentNode.style.borderColor=""),r&&(r.style.borderColor=""),l&&(l.className="gig-comments-addComment-ratings"),!e&&"mandatory"!=this._settings.enableCommentBody.split("_")[1]||g&&""!=g.value.replace(/ /g,"").replace(/\n/g,"").replace(/\r/g,"")||(g.parentNode.parentNode.style.borderColor="#e70707",n=g,g.onchange=m,d=!1),"mandatory"==this._settings.enableCommentTitles.split("_")[1]&&r&&""==r.value.replace(/ /g,"").replace(/\n/g,"").replace(/\r/g,"")&&(r.style.borderColor="#e70707",n=r,r.onchange=m,d=!1),e||"mandatory"!=this._settings.enableRatings.split("_")[1]||this.selectedRatings&&this.selectedRatings._overall||(l.className="gig-comments-addComment-ratings gig-comments-addComment-ratings-error",d=!1),o&&(d?(o.style.display="none",o.innerHTML=""):(o.innerHTML="ratingsOnly"==this._settings.mode?s("please_select_your_rating"):s("please_fill_required_fields"),o.style.display="block")),{v:d,el:n}}},postButtonClicked:function(e,t){var i=this.containerID;e&&(i=this.containerID+"-reply-"+e),this._user.isGuest&&(document.cookie="_gig_comments_locked=1; path=/",this._user.locked=!0);var o=document.getElementById(i+"-commentTextarea"),n=document.getElementById(i+"-titleTextbox"),a=o?window.gigya.pluginUtils.text.normalizeLinebreaks(o.value):"",m=n?n.value:null,g=this.validatePost(e);if(g.v)if(this._user.isGuest||this._user.isConnected){if(n&&(n.value=""),o&&(o.value=""),!e){var r={};for(var l in this.selectedRatings)r[l]=parseInt(this.selectedRatings[l].value)}this.clearRatings();var d=this.saveCheckedProviders(i).join(","),c=(new Date).getTime(),u="pending_"+c,p=this.getCommentByID(e);null!=p&&p.closeReplybox();var h=this._user.thumbnailURL;h&&""!=h||(h=this._user.photoURL),h=window.gigya.global.getPhotoURL(h);var v=this._user.nickname;""==v&&(v="Anonymous");var b=this.getLoginProvider(),f={timestamp:c,commentText:a,threadTimestamp:c,ID:u,parentID:e,sender:{photoURL:h,loginProvider:b,name:v},isTemp:!0,commentTitle:m,isPost:!0};"reviews"==this.textMode&&"disabled"!=this._settings.enableRatings&&(f.ratings=r),1==this._settings.moderationState&&(f.isPending=!0);C=this;var _=window.gigya.utils.object.removeUndefined({categoryID:this._p.categoryID,streamID:this._p.streamID,cid:this._p.cid,commentText:a,parentID:e,commentTitle:m,ratings:r});this._user.isGuest&&(_.guestName=this._user.nickname,_.guestEmail=this._user.email);var w=window.gigya.utils.object.clone(_);if(w.guestName||(w.guestName=""),w.guestEmail||(w.guestEmail=""),w.eventName="beforeCommentSubmitted",0!=window.gigya.events.dispatchForWidget(w,this._p)){_=w,""==w.guestName&&delete w.guestName,""==w.guestEmail&&delete w.guestEmail;var x,y=this.addComment(f);x=e?document.getElementById("gig-replies-"+e):document.getElementById(this.containerID+"-comments"),"dateasc"==this._settings.sortBy.toLowerCase()?x.appendChild(y):x.insertBefore(y,x.firstChild),_.callback=function(t){if(C._user.isGuest&&C._drawCommentBox(),t.errorCode>0){var i;switch(t.errorCode){case 403037:i=s("only_one_review_per_product_is_allowed");break;default:i=s("an_error_has_occurred_please_try_again_later","%errorCode",t.errorCode)}var o=document.getElementById(C.containerID+"-error-"+u);o&&i&&(o.innerHTML=i),window.gigya.events.dispatchErrorFromResponse(C._p,t)}else{var n=window.gigya.utils.object.clone(f,!0);for(var g in t.comment)n[g]=t.comment[g];n.isTemp=!1,n.isPost=!0,"reviews"==C.textMode&&0!=n.level||C._commentCount++;for(var l=0;l<C._commentsRawData.length;l++)if(C._commentsRawData[l].ID==u){C._commentsRawData.splice(l,1);break}delete C.commentsInstances[u],C.addComment(n,y);var d=C.getCommentByID(n.ID);d.updateVoteUI(),C.updateCount(),e&&d.getParentComment().updateRepliesCount();var c={eventName:"commentSubmitted",streamID:C._p.streamID,categoryID:C._p.categoryID,commentText:a,comment:t.comment,mode:C.textMode};r&&(c.ratings=r),m&&(c.commentTitle=m),t.comment&&t.comment.providerPostIDs&&(c.providerPostIDs=t.comment.providerPostIDs),""!=C._user.UID?c.user=C._user:C._user.isGuest&&(c.guestUser={nickname:C._user.nickname,email:C._user.email}),"reviews"==C.textMode&&(C._userComments||(C._userComments=[]),C._userComments.push(t.comment),C._drawCommentBox()),window.gigya.events.dispatchForWidget(c,C._p)}},"dateasc"==this._settings.sortBy.toLowerCase()&&(this.nopaging=!0),_.userAction=this.getUserAction(f),_.enabledProviders=d,this._p.commentTags&&(_.tags=this._p.commentTags),!t&&d||(_.enabledProviders=" "),window.gigya.comments.postComment(this._c,_),this.setStreamInfoIfNeeded()}}else{var C=this,k=this.isMobileUI?i:i+"-postButton",I=this.isMobileUI?null:document.getElementById(k);this.loginClicked(k,I,function(){C.postButtonClicked(e,!0)},!this.isMobileUI)}else g.el&&g.el.focus()},addComment:function(e,t){"dateasc"==this._settings.sortBy.toLowerCase()?this._commentsRawData.push(e):this._commentsRawData.unshift(e),this._comments=n.buildCommentsTree(this._commentsRawData,this._settings.sortBy,this);var i=this.getCommentByID(e.ID),o=document.createElement("div");return o.innerHTML=n.drawComments([i],this,i.level),o=o.firstChild,t&&(t.parentNode.insertBefore(o,t),t.parentNode.removeChild(t)),o},drawNewComments:function(e,t){for(var i,o=0;o<e.length;o++){var s=e[o],a=s.getContainer();if(a)t&&s.children&&this.drawNewComments(s.children,t);else{var m=document.createElement("div");m.innerHTML=n.drawComments([s],this,s.level),a=m.firstChild;var g=document.getElementById("gig-replies-"+s.parentID);g||(g=document.getElementById(this.containerID+"-comments")),i?i.nextSibling?g.insertBefore(a,i.nextSibling):g.appendChild(a):g.insertBefore(a,g.firstChild),s.updateVoteUI(),s.updateRepliesCount(),t&&s.markAsNew(),this._settings.repliesCollapsed&&s.collapse(),this._state.flags[s.id]&&s.markAsFlagged()}i=a}this.updateCount()},updateCount:function(){var e=this.getElementByCommentsClass("commentList-header-commentsCount");if(e){var t="";this._settings.disableCommentsCount||null==this._commentCount||(t=1==this._commentCount?s("reviews"==this.textMode?"one_review":"one_comment"):s("reviews"==this.textMode?"num_reviews":"num_comments","%num",this._commentCount),"fr"==this._p.lang&&"0"==this._commentCount&&(t=s("reviews"==this.textMode?"one_review":"one_comment").replace("1","0"))),e.innerHTML=t}},getUserAction:function(e){var t=this._p.userAction;e.level>0&&(t=this._p.replyUserAction),(t=t?t.clone():new window.gigya.socialize.UserAction).title&&""!=t.title||("reviews"!=this.textMode||e.level?t.title=s("commented_on_colon_pagetitle","%pageTitle",document.title):e.ratings&&e.ratings._overall?t.title=s("i_rated_pagetitle_as_rating_5","%rating",e.ratings._overall).replace("%pageTitle",document.title):t.title=s("my_review_on_colon_pagetitle","%pageTitle",document.title)),t.linkBack&&""!=t.linkBack||(t.linkBack=document.location.href),t.userMessage=e.commentText;var i={commentTitle:e.commentTitle,commentText:e.commentText,rating:e.ratings?e.ratings._overall:null};return i.ratingDescription=[s("i_hate_it"),s("i_dont_like_it"),s("its_ok"),s("i_like_it"),s("i_love_it")][i.rating-1],window.gigya.global.fillUserActionTemplate(t,i)},saveCheckedProviders:function(e){var t=[];if(this.isMobileUI){if(o=document.getElementById(e+"-checkbox-provider-cb")){var i=this.getLoginProvider();o.checked&&t.push(i),document.cookie="_gig_comments_cb_"+i+"="+(o.checked?1:0)+';expires=Wed, 01 Jan 2020 12:00:00 GMT";path=/;"'}}else for(var i in this._user.identities){var o;(o=document.getElementById(e+"-checkbox-"+i+"-image"))&&(o.checked&&t.push(i),document.cookie="_gig_comments_cb_"+i+"="+(o.checked?1:0)+';expires=Wed, 01 Jan 2020 12:00:00 GMT";path=/;"')}return t},getSingleShareProvider:function(){var e=this.getLoginProvider();if(e&&window.gigya.socialize.getProvidersForRequiredCapabilities(window.gigya.socialize.getProvidersByName(e),["actions"]).length>0)return e;var t=window.gigya.socialize.getProvidersByName(this._p.enabledProviders?this._p.enabledProviders:"*");t=window.gigya.socialize.hideProvidersByName(t,this._p.disabledProviders?this._p.disabledProviders:"");var i=window.gigya.socialize.getProvidersForRequiredCapabilities(t,["actions"]);return i.length>0?i[0].name:t.length>0?t[0].name:void 0},getLoginProvider:function(){var e=this._user.loginProvider;if(!e)for(var t in this._user.identities){e=t;break}return e},checkboxClicked:function(e,t){var i=document.getElementById(e);if(i){var o=e.split("-"),n=this.isMobileUI?this.getSingleShareProvider():o[o.length-1],s=this._user.identities[n],a=s&&s.missingPermissions&&-1!=s.missingPermissions.toLowerCase().indexOf("actions"),m=document.getElementById(e+"-image"),g=(m&&m.className,this.isMobileUI?i.checked:m.checked);if(g&&t)return;var r=-1!=e.indexOf("-reply-")?"replyBox":"commentBox";if(g||s&&!a)this.isMobileUI||(m.className=g?"gig-comments-checkboxImage gig-comments-"+r+"-checkboxImage":"gig-comments-checkboxImage gig-comments-"+r+"-checkboxImage gig-comments-checkboxImage-checked gig-comments-"+r+"-checkboxImage-checked",m.checked=!g);else{var l=this,d={pendingRegistration:this._p.pendingRegistration,cid:this._p.cid,context:this._p.context,permissions:"actions",provider:n};a?(d.callback=function(e){0==e.errorCode&&(l.isMobileUI?i.checked=!0:(m.checked=!0,m.className="gig-comments-checkboxImage gig-comments-"+r+"-checkboxImage gig-comments-checkboxImage-checked gig-comments-"+r+"-checkboxImage-checked"))},window.gigya.socialize.requestPermissions(this._c,d)):(d.callback=function(e){e.user&&(l._user=e.user,this.isMobileUI?i.checked=!0:(m.checked=!0,m.className="gig-comments-checkboxImage gig-comments-"+r+"-checkboxImage gig-comments-checkboxImage-checked gig-comments-"+r+"-checkboxImage-checked"))},window.gigya.socialize.addConnection(this._c,d))}}},updateCheckboxesDisplay:function(){for(var e=0;e<this.arProviders.length;e++){var t=arProviders[e];if(this._user.identities&&this._user.identities[t.name]){var i=document.getElementById(this.containerID+"-checkbox-"+arProviders[e]);i.style.display="",this.lastReplyId&&(i=document.getElementById(this.containerID+"-reply-"+this.lastReplyId+"-checkbox-"+arProviders[e]))&&(i.style.display="")}}},isEmail:function(e){return e=e.replace(/(^[ ]+|[ ]+$)/g,""),!!window.gigya.global.isEmail(e)},guestLoginClicked:function(e){var t=document.getElementById(e+"-nickname"),i=document.getElementById(e+"-email");if(t.value.replace(/ /g,"").length<3||!t.watermarkCleared){var o=s("nickname_should_be_at_least_3_characters");document.getElementById(e+"-guestErrorPlaceholder").innerHTML=o}else if(!this._settings.isGuestEmailRequired&&!i.watermarkCleared||this.isEmail(i.value))document.cookie="_gig_comments_nickname="+escape(t.value)+"; path=/",""!=i.value&&i.watermarkCleared&&(document.cookie="_gig_comments_email="+escape(i.value)+"; path=/"),this._user=this._getGuestUser(),this._updateUserInfo();else{o=s("please_provide_a_valid_email_address");document.getElementById(e+"-guestErrorPlaceholder").innerHTML=o}},closeLastReply:function(){null!=this.lastReplyId&&this.getCommentByID(this.lastReplyId).closeReplybox()},replyClicked:function(e,t){if(this.lastReplyId!=e){this._user;this.closeLastReply();var i=this.containerID+"-reply-"+e,o=this.buildCommentBoxItem(o,e);o.width=this._p.width;var n=this._templates.commentBox;document.getElementById(i).innerHTML=window.gigya.utils.templates.fill(n,o),document.getElementById(i).style.display="block",t&&(document.getElementById(i+"-commentTextarea").value=t),document.getElementById(this.containerID+"-replybutton-"+e).className="gig-comments-button gig-comments-button-reply gig-comments-button-down gig-comments-button-reply-down",this._checkProviders(i);var s=document.getElementById(i+"-commentTextarea");s&&s.focus(),this.lastReplyId=e}else this.closeLastReply()},buildCommentBoxItem:function(e,t){var o;t&&(o=this.getCommentByID(t).username),e||(e={});var a=this,m=this._user;t?(e.id=this.containerID+"-reply-"+t,e.rootClass="replyBox",e.closeIcon=this.isMobileUI?"":this._templates.closeIcon,e.onCloseClicked=this.getCommentByID(t).getRefString()+".closeReplybox()",e.onPostButtonClicked=this.getRefString()+".postButtonClicked('"+t+"')",e.post_a_new_comment=s("reviews"==this.textMode?"comment_on_username_review":"reply_to_username","%username",window.gigya.utils.sanitize.sanitizeHTML(window.gigya.global.wbr(o,20)))):(e.id=this.containerID,e.rootClass="commentBox",e.onPostButtonClicked=this.getRefString()+".postButtonClicked()",e.post_a_new_comment="reviews"==this.textMode?s("post_your_review"):s("post_a_new_comment"),e.closeIcon=""),e.login=this.isMobileUI?"reviews"==this.textMode?s("login_to_review"):s("login_to_comment"):s("login"),e.or=s("or"),e.guest=s("guest"),e.guestDropdown=this._settings.allowGuest?this._templates.guestDropdown:"",e.loginDropdown=this._templates.loginDropdown,e.userImage=this._templates.userImage,e.photoDiv=this._templates.photoDiv48,e.addComment=this._templates.addComment,e.postButton=this._templates.postButton,e.followLink=this.isMobileUI||t?"":this._templates.followLink,e.validationErrorPlaceholder=this._templates.validationErrorPlaceholder,e.ratings="",e.titleTextbox="",e.addCommentTextarea="",this._settings.enableCommentBody&&"disabled"==this._settings.enableCommentBody||(e.addCommentTextarea=this._templates.addCommentTextarea),e.maxLength=this._settings.maxCommentLength;var g="ratingsOnly"==this._settings.mode?"":'<span class="gig-comments-mandatoryMark">&#160;*</span>';if(!t){if(this._settings.enableRatings&&"disabled"!=this._settings.enableRatings){this._settings.ratings={_overall:s("overall_rating")};var r=this._templates.editableRating;for(var l in this._settings.ratings)e.ratings+=window.gigya.utils.templates.fill(r,{id:e.id+"_rating_"+l,ratingID:l,details:this.isMobileUI?[]:[s("i_hate_it"),s("i_dont_like_it"),s("its_ok"),s("i_like_it"),s("i_love_it")],name:this._settings.ratings[l]+":"+("mandatory"==this._settings.enableRatings.split("_")[1]?g:""),onClick:this.getRefString()+".onRatingClick(this)",onMouseOver:this.getRefString()+".onRatingMouseOver(this)",onMouseOut:this.getRefString()+".onRatingMouseOut(this)",actionAttribute:this.isMobileUI?"ontouchstart":"onclick"})}this._settings.enableCommentTitles&&"disabled"!=this._settings.enableCommentTitles&&(e.titleTextbox=this._templates.titleTextbox)}var d=this._templates.addCommentLabel,c=e.titleTextbox&&"reviews"==this.textMode?s("summary_colon"):"";""!=c&&"mandatory"==this._settings.enableCommentTitles.split("_")[1]&&(c+=g),e.titleLabel=""!=c?window.gigya.utils.templates.fill(d,{labelID:"titleLabel",labelText:c,rootClass:e.rootClass}):"";var u=t||!e.addCommentTextarea?"":"reviews"==this.textMode?s("review_colon"):"";""!=u&&"mandatory"==this._settings.enableCommentBody.split("_")[1]&&(u+=g),e.commentLabel=""!=u?window.gigya.utils.templates.fill(d,{labelID:"commentLabel",labelText:u,rootClass:e.rootClass}):"",e.providersCheckboxes=this._templates.providersCheckboxes,e.providersCheckboxesContent=this._templates.providersCheckboxesContent,e.onLoginClick=this.getRefString()+".loginClicked('"+e.id+"')",e.onGuestClick=this.getRefString()+".guestClicked('"+e.id+"')";var p=this._user.photoURL;p&&""!=p||(p=this._user.thumbnailURL),(p=window.gigya.global.getPhotoURL(p))&&""!=p||(p=i+"avatar_48x48.gif"),e.photoURL=p;var h=m.nickname;h&&(h=window.gigya.utils.sanitize.sanitizeHTML(window.gigya.global.wbr(h,20)).replace(/\$/g,"&#36;")),""==h&&(h="Anonymous"),e.username=h,e.providerImage="",e.drawProviders=function(){return a._drawProviders(e.id)},e.share_to=this.isMobileUI?"":s("share_to"),e.post=s("post"),e.onLogoutClick=this.getRefString()+".logout()",e.onCheckboxClicked=this.getRefString()+".checkboxClicked(this.id)",e.onFollowClicked=this.getRefString()+".onFollowClicked()",n.isSharePossible()||(e.share_to="",e.providersCheckboxes=""),this._user.isConnected||(e.share_to="");var v=this.getLoginProvider();if(v){var b=window.gigya.socialize._getProviderByName(v);b&&6002!=b.ID&&(e.providerImage=this._templates.providerImage,e.providerImageURL=i+"providers/"+v+"User_14x14.gif")}return this._settings.useSiteLogin&&(e.loginDropdown=this._templates.loginDropdownNative),this._user.locked?e.logoutLink="":e.logoutLink=this._templates.logoutLink,e.loginCanvas=this._templates.loginCanvas,this._user.isGuest||this._user.isConnected?this._user.isGuest?(e.logout=s("change"),e.onLogoutClick=this.getRefString()+".guestLogout()",e.loginCanvasContent=this._templates.loginCanvas_loggedIn_guest):(e.logout=s("logout"),e.onLogoutClick=this.getRefString()+".logout()",e.loginCanvasContent=this._templates.loginCanvas_loggedIn):this.isMobileUI?e.loginCanvasContent=this._templates.loginCanvas_loggedOut_mobile:this._settings.allowGuest?e.loginCanvasContent=this._templates.loginCanvas_loggedOutWithGuest:e.loginCanvasContent=this._templates.loginCanvas_loggedOut,e},loginClicked:function(e,t,i,o){if(this._settings.useSiteLogin)window.gigya.events.dispatchForWidget({eventName:"siteLoginClicked"},this._p);else{var n=document.getElementById(e+"-login"),a=document.getElementById(e+"-loginDropdown"),m=-1;if(t||(t=a,m=-2),!t)return;if(n)"none"!=n.style.display?n.fncHide():n.fncShow();else{var g=t.offsetWidth<140?140:t.offsetWidth;this.isMobileUI&&g<250&&(g=document.body.offsetWidth-6),(n=document.createElement("div")).id=e+"-login",n.className="gig-comments-container gig-comments-loginUI",n.innerHTML=(this.isMobileUI?"":'<div class="gig-comments-loginUI-pleaseLogin" id="'+n.id+'-pleaseLogin">'+s("please_login")+"</div>")+'<div id="'+n.id+'-loginUI" class="gig-comments-loginUI-content"></div>',n.fncHide=function(e){if(e){if(e.target&&(-1!=e.target.id.indexOf(n.id)||e.target==t))return;if(e.srcElement&&(-1!=e.srcElement.id.indexOf(n.id)||e.srcElement==t))return}window.gigya.utils.DOM.hideByID(n.id),document.attachEvent?document.detachEvent("onclick",n.fncHide):document.addEventListener&&document.removeEventListener("click",n.fncHide,!1),a&&(a.className="gig-comments-dropdown gig-comments-dropdown-login"),n.fncHide=null,n&&n.parentNode&&n.parentNode.removeChild(n)},n.fncShow=function(){window.gigya.utils.DOM.showByID(n.id),window.setTimeout(function(){window.gigya.pluginUtils.DOM.removeElementOnDocClick(n,null,null)},50);var e=window.gigya.global._GetElementPos(t);n.style.left=""+(window.gigya.localInfo.quirksMode?e.left-2:e.left)-g+t.offsetWidth+"px",n.style.top=e.top+(o?0:t.offsetHeight+m+(window.gigya.localInfo.quirksMode?-2:0))+"px",parseInt(n.style.left)<0&&(n.style.left="3px"),a&&(a.className="gig-comments-dropdown gig-comments-dropdown-login gig-comments-dropdown-down gig-comments-dropdown-login-down")},document.body.appendChild(n);var r={pendingRegistration:this._p.pendingRegistration,context:this._p.context,permissions:"actions",UIConfig:this._p.addConnectionsUIConfig?this._p.addConnectionsUIConfig:this._p.loginUIConfig,sessionExpiration:this._p.sessionExpiration,enabledProviders:this._p.enabledProviders,disabledProviders:this._p.disabledProviders,containerID:n.id+"-loginUI",useHTML:!0,showTermsLink:!1,hideGigyaLink:!0,width:g-2,height:this.isMobileUI?200:65,buttonsStyle:this.isMobileUI?"fulllogo":"standard",cid:this._p.cid,timestamp:this._p.timestamp,signature:this._p.signature,onButtonClicked:function(){window.setTimeout(n.fncHide,1e3)},requiredCapabilities:"",onConnectionAdded:i,onLogin:i,buttonSize:this.isMobileUI?45:null,useLargeArrows:!!this.isMobileUI||null};window.gigya.socialize.showAddConnectionsUI(this._c,r),n.fncShow()}}},redraw:function(){if(this._settings&&this._user){var e=this._getGuestUser();!this._user.isConnected&&e.nickname&&this._settings.allowGuest&&(this._user=e),this._drawComments(),this._drawCommentBox(),this.updateFollowUI(),this.updateSubscribeUI(),this.firedLoadEvent||(this.firedLoadEvent=!0,window.gigya.events.dispatchForWidget({eventName:"load",version:t.comments.version},this._p),window.gigya.utils.DOM.enableSafeCopy(document.getElementById(this.containerID)))}},_updateUserInfo:function(e){var t=this.containerID;e&&(t=this.containerID+"-reply-"+e);var i=this.buildCommentBoxItem(i,e),o=document.getElementById(t+"-loginCanvas");o&&(o.innerHTML=window.gigya.utils.templates.fill(i.loginCanvasContent,i));var n=document.getElementById(t+"-providersCheckboxes");n&&(this._user.isConnected?(this.isMobileUI&&(n.innerHTML=window.gigya.utils.templates.fill(i.providersCheckboxesContent,i)),n.style.visibility="visible"):(n.innerHTML=window.gigya.utils.templates.fill(i.providersCheckboxesContent,i),n.style.visibility="hidden"));var s=document.getElementById(t+"-postButton");s&&(s.innerHTML=window.gigya.utils.templates.fill(i.postButton,i));var a=document.getElementById(t+"-shareTo");a&&(a.innerHTML=i.share_to),this._checkProviders(this.containerID);var m=document.getElementById(t+"-guestUI");m&&m.parentNode.removeChild(m);var g=document.getElementById(t+"-login");if(g&&g.parentNode.removeChild(g),this.lastReplyId&&e!=this.lastReplyId&&this._updateUserInfo(this.lastReplyId),!e){for(var r in this.commentsInstances)this.commentsInstances[r].updateVoteUI();this._updateSelfComments(),this.updateFollowStatus(),this.updateSubscribeStatus(),this.updateCheckboxesDisplay()}},_updateSelfComments:function(){if(this._settings.allowCommentDeletion||"reviews"==this.textMode){var e=this;window.gigya.comments.getUserComments(this._p,{includeReplies:!0,callback:function(t){if(t&&t.comments){e._userComments=t.comments;for(var i=0;i<t.comments.length;i++){var o=t.comments[i].ID;e.commentsInstances[o]&&(e.commentsInstances[o].data.sender.isSelf=!0)}}else for(var o in e._userComments=[],e.commentsInstances)e.commentsInstances[o].data.sender.isSelf=!1;"reviews"==e.textMode&&e._drawCommentBox()}})}},_updateVotes:function(){if(this._settings.enableVoting){var e=this;window.gigya.comments.getUserVotes(this._c,{callback:function(t){if(t.userVotes)for(var i in e.commentsInstances){var o=e.getCommentByID(i);o.voteInProgress||(o.vote=t.userVotes[i],o.updateVoteUI())}}})}},_getGuestUser:function(){var e,t;return this._settings.allowGuest&&(e=this._getCookie("_gig_comments_nickname"),t=this._getCookie("_gig_comments_email"),null!=e&&(e=unescape(e)),null!=t&&(t=unescape(t))),{UID:"",nickname:e,isGuest:null!=e,email:t,locked:this._getCookie("_gig_comments_locked")}},_getInfo:function(){var e=this,t={};t.oauth_token=this._p.oauth_token,t.cid=this._p.cid,t.callback=function(t){0==t.errorCode?(e._user=t.user,e.redraw()):e.broadcastedError||(this.container&&(this.container.innerHTML=""),window.gigya.events.dispatchErrorFromResponse(e._p,t),e.broadcastedError=!0)},window.gigya.socialize.getUserInfo(this._c,t)},_drawCommentBox:function(){var e,t=this.buildCommentBoxItem();if(!this._settings.allowMultipleReviewsPerUser&&this._userComments)for(var i=0;i<this._userComments.length;i++)if(!this._userComments[i].parentID){e=this._userComments[i];break}if("reviews"==this.textMode&&e){window.gigya.utils.object.add(t,{post_a_new_comment:s("your_review"),myRatingLabel:e.ratings&&e.ratings._overall?s("my_rating_colon"):"",mySummaryLabel:e.commentTitle?s("summary_colon"):"",myReviewLabel:e.commentText?s("review_colon"):"",rating:"",summary:e.commentTitle?e.commentTitle:"",review:e.commentText?e.commentText:""});var o=this._templates.rating;e.ratings&&e.ratings._overall&&(t.rating=window.gigya.utils.templates.fill(o,{value:e.ratings?e.ratings._overall:0,starClassName:"gig-comments-star-myRating"}));var n=this._templates.myRating;document.getElementById(this.containerID+"-commentBox").innerHTML=window.gigya.utils.templates.fill(n,t)}else if(null!=this._settings&&"readOnly"!=this.streamInfo.status&&!this._settings.readOnly){t.width=this._p.width;n=this._templates.commentBox;var a=document.getElementById(this.containerID+"-commentTextarea");a&&(ommentText=a.value),document.getElementById(this.containerID+"-commentBox").innerHTML=window.gigya.utils.templates.fill(n,t),document.getElementById(this.containerID+"-commentTextarea")&&(document.getElementById(this.containerID+"-commentTextarea").value=""),this._checkProviders(this.containerID)}var m=document.getElementById(this.containerID+"-guestUI");m&&m.parentNode.removeChild(m);var g=document.getElementById(this.containerID+"-login");g&&g.parentNode.removeChild(g)},_getCookie:function(e){for(var t=document.cookie.split(";"),i=0;i<t.length;i++){for(var o=t[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(e))return o.substring(e.length+1,o.length)}return null},_checkProviders:function(e,t){var i=document.getElementById(e+"-providersCheckboxes");if(i&&this._user.isConnected&&(i.style.visibility="visible"),t||this._settings.shareToSNCheckboxChecked)if(this.isMobileUI){if(this._user.isConnected){var o=this.getSingleShareProvider();if(!(n=this._user.identities[o]).missingPermissions||-1==n.missingPermissions.toLowerCase().indexOf("actions"))null!=(s=this._getCookie("_gig_comments_cb_"+o))&&1!=s||this.checkboxClicked(e+"-checkbox-provider-cb",!0)}}else for(var o in this._user.identities){var n,s;if(!(n=this._user.identities[o]).missingPermissions||-1==n.missingPermissions.toLowerCase().indexOf("actions"))null!=(s=this._getCookie("_gig_comments_cb_"+o))&&1!=s||this.checkboxClicked(e+"-checkbox-"+o,!0)}},_drawProviders:function(e){var t=[],i=this._p.enabledShareProviders?this._p.enabledShareProviders:this._p.enabledProviders;i||(i="*");var o=this._p.disabledShareProviders?this._p.disabledShareProviders:this._p.disabledProviders;o||(o=""),arProviders=window.gigya.socialize.getProvidersByName(i),arProviders=window.gigya.socialize.hideProvidersByName(arProviders,o),arProviders=window.gigya.socialize.getProvidersForRequiredCapabilities(arProviders,["actions"]);for(var n=[],a=[],m=0;m<arProviders.length;m++)this._user.identities&&this._user.identities[arProviders[m].name]?n.push(arProviders[m]):a.push(arProviders[m]);arProviders=n.concat(a),this.arProviders=arProviders;var g=this._p.minShareOptions?this._p.minShareOptions:2,r=Math.max(g,n.length);if(this.isMobileUI){var l=this.getSingleShareProvider();l=window.gigya.socialize.getProvidersByName(l)[0].displayName;var d={id:e+"-checkbox-provider",post_to_provider:s("post_to_provider","%provider",l)},c=this._templates["providerCheckbox-mobile"];t.push(window.gigya.utils.templates.fill(c,d))}else{for(m=0;m<arProviders.length;m++){var u=arProviders[m];d={id:e+"-checkbox-"+u.name,iconURL:window.gigya._.getCdnResource("/gs/i/shareBar/icons/"+u.name+".png"),style:m>r-1?"display:none;":""},c=this._templates.providerCheckbox;t.push(window.gigya.utils.templates.fill(c,d))}arProviders.length>r&&t.push(window.gigya.utils.templates.fill(this._templates.moreLink,{more:s("more"),onClick:this.getRefString()+".showMoreProvidersDialog(this, '"+e+"')"}))}return t.join("")},showMoreProvidersDialog:function(e,t){for(var i=[],o=0;o<this.arProviders.length;o++){var n=document.getElementById(t+"-checkbox-"+arProviders[o].name);n&&"none"==n.style.display&&i.push(this.arProviders[o])}this.hideMoreProvidersDialog();var a=[];for(o=0;o<i.length;o++){var m=i[o];a.push(window.gigya.utils.templates.fill(this._templates.moreProvider,{providerName:m.displayName,iconWidth:"22px",onClick:this.getRefString()+".onMoreProviderClick('"+m.name+"','"+t+"')",iconURL:window.gigya._.getCdnResource("/gs/i/edit/"+m.name+".png")}))}var g=this._templates.moreProvidersDialog,r={more_share_destinations:s("more_share_destinations"),moreProvidersHTML:a.join(""),onCancel:this.getRefString()+".hideMoreProvidersDialog()"},l=this.containerID+"-moreProvidersDialog",d=window.gigya.utils.DOM.createTopLevelDiv(l+"_container");d.style.position="absolute",d.className="gig-comments-container",d.innerHTML=window.gigya.utils.templates.fill(g,r);var c=window.gigya.global._GetElementPos(e),u=window.gigya.utils.viewport.getScroll().top+window.gigya.utils.viewport.getInnerSize().h;c.top+d.offsetHeight>u?d.style.top=c.top-d.offsetHeight+"px":d.style.top=c.top+e.offsetHeight+"px",d.style.left=c.left+"px";var p=this;d.fncHide=function(){p.hideMoreProvidersDialog()},window.setTimeout(function(){document.attachEvent?document.attachEvent("onclick",d.fncHide):document.addEventListener&&document.addEventListener("click",d.fncHide,!1)},50)},hideMoreProvidersDialog:function(){var e=document.getElementById(this.containerID+"-moreProvidersDialog_container");e&&(e.parentNode.removeChild(e),document.detachEvent?document.detachEvent("onclick",e.fncHide):document.removeEventListener&&document.removeEventListener("click",e.fncHide,!1))},onMoreProviderClick:function(e,t){this.hideMoreProvidersDialog(),this.checkboxClicked(t+"-checkbox-"+e,!0)},start:function(){this.commentsInstances||(this.commentsInstances={});var e=this._p.deviceType?this._p.deviceType.toLowerCase():"desktop";this.isMobileUI="mobile"==e||"auto"==e&&window.gigya.localInfo.isMobile,(this._p.cssPrefix||1==n.instances_size)&&(window.gigya.global.addCSS(n.defaults.css,this._p.cssPrefix),this.isMobileUI?window.gigya.global.addCSS(n.defaults.mobileCSS,this._p.cssPrefix):window.gigya.global.addCSS(n.defaults.nonMobileCSS,this._p.cssPrefix),window.gigya.localInfo.isMobile&&window.gigya.localInfo.isSafari&&window.gigya.global.addCSS(".gig-comments-container * {-webkit-text-size-adjust:none;}",this._p.cssPrefix));var t=this._p.width;document.getElementById(this.containerID).style.width=this.isMobileUI?"100%":t+"px",document.getElementById(this.containerID).className="gig-comments-container",this.isMobileUI||(window.gigya.global.addCSS("#"+this.containerID+" textarea.gig-comments-replyBox-textarea {width:"+(window.gigya.localInfo.quirksMode?t-37:t-30)+"px}"),window.gigya.global.addCSS("#"+this.containerID+" textarea.gig-comments-commentBox-textarea {width:"+(window.gigya.localInfo.quirksMode?t-17:t-10)+"px}")),document.getElementById(this.containerID).innerHTML='<div class="gig-comments-progress"></div>',this._getInfo(),this._getComments();var i=this;window.gigya.socialize.addEventHandlers({listenerType:"component"},{listenerDescription:"listener for updating a comments widget",onLogout:function(){i._user=i._getGuestUser(),i._updateUserInfo()},onLogin:function(e){i._user=e.user,i._updateUserInfo(),i._updateVotes()},onConnect:function(e){var t=i._user.isConnected;i._user=e.user,t!=i._user.isConnected&&i._updateUserInfo(),i._updateVotes()},onDisconnect:function(e){i._user=e.user,i._user.isConnected||i._updateUserInfo()}})},getRefString:function(){return"gigya.comments.plugins.comments.instances['"+encodeURIComponent(this.id)+"']"}},t.comments={showCommentsUI:function(e,t,i){void 0!==e.commentsServer&&e.commentsServer,n.setDefaultTemplates(),n.lang=t.lang,n.createInstance(e,t,i)},instances:n.instances,version:"1",imgOnLoad:function(e,t){window.gigya.global.scaleImage(e,t,!0,function(){e.parentNode.style.visibility=""})}}}}(window.gigya.comments)}});