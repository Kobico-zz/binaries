!function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=276)}({0:function(t,e,o){"use strict";o.r(e),function(t){o.d(e,"__extends",function(){return r}),o.d(e,"__assign",function(){return i}),o.d(e,"__rest",function(){return a}),o.d(e,"__decorate",function(){return s}),o.d(e,"__param",function(){return l}),o.d(e,"__metadata",function(){return p}),o.d(e,"__awaiter",function(){return u}),o.d(e,"__generator",function(){return d}),o.d(e,"__exportStar",function(){return g}),o.d(e,"__values",function(){return h}),o.d(e,"__read",function(){return c}),o.d(e,"__spread",function(){return f}),o.d(e,"__spreadArrays",function(){return y}),o.d(e,"__await",function(){return m}),o.d(e,"__asyncGenerator",function(){return _}),o.d(e,"__asyncDelegator",function(){return w}),o.d(e,"__asyncValues",function(){return P}),o.d(e,"__makeTemplateObject",function(){return E}),o.d(e,"__importStar",function(){return v}),o.d(e,"__importDefault",function(){return S});var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};function r(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var i=function(){return(i=t||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function a(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o}function s(t,e,o,n){var r,i=arguments.length,a=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(i<3?r(a):i>3?r(e,o,a):r(e,o))||a);return i>3&&a&&Object.defineProperty(e,o,a),a}function l(t,e){return function(o,n){e(o,n,t)}}function p(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e,o,n){return new(o||(o=gigya.Promise))(function(r,i){function a(t){try{l(n.next(t))}catch(t){i(t)}}function s(t){try{l(n.throw(t))}catch(t){i(t)}}function l(t){t.done?r(t.value):new o(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})}function d(t,e){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function g(t,e){for(var o in t)e.hasOwnProperty(o)||(e[o]=t[o])}function h(t){var e="function"==typeof Symbol&&t[Symbol.iterator],o=0;return e?e.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}}function c(t,e){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,r,i=o.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a}function f(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}function y(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<o;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,r++)n[r]=i[a];return n}function m(t){return this instanceof m?(this.v=t,this):new m(t)}function _(t,e,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=o.apply(t,e||[]),i=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){r[t]&&(n[t]=function(e){return new gigya.Promise(function(o,n){i.push([t,e,o,n])>1||s(t,e)})})}function s(t,e){try{(o=r[t](e)).value instanceof m?gigya.Promise.resolve(o.value.v).then(l,p):u(i[0][2],o)}catch(t){u(i[0][3],t)}var o}function l(t){s("next",t)}function p(t){s("throw",t)}function u(t,e){t(e),i.shift(),i.length&&s(i[0][0],i[0][1])}}function w(t){var e,o;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,r){e[n]=t[n]?function(e){return(o=!o)?{value:m(t[n](e)),done:"return"===n}:r?r(e):e}:r}}function P(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,o=t[Symbol.asyncIterator];return o?o.call(t):(t=h(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(o){e[o]=t[o]&&function(e){return new gigya.Promise(function(n,r){(function(t,e,o,n){gigya.Promise.resolve(n).then(function(e){t({value:e,done:o})},e)})(n,r,(e=t[o](e)).done,e.value)})}}}function E(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function v(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var o in t)Object.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e.default=t,e}function S(t){return t&&t.__esModule?t:{default:t}}}.call(this,o(0).__assign)},276:function(t,e,o){(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n=o(277),r=o(279),i=o(281),a=o(283),s=o(285),l=o(287);window.gigya._||(window.gigya._={}),window.gigya._.plugins||(window.gigya._.plugins={}),window.gigya._.plugins.profilePhoto||(window.gigya._.plugins.profilePhoto={}),window.gigya._.plugins.resources||(window.gigya._.plugins.resources={}),window.gigya._.plugins.resources.css||(window.gigya._.plugins.resources.css={}),window.gigya._.plugins.resources.css.profilePhoto||(window.gigya._.plugins.resources.css.profilePhoto={}),window.gigya._.plugins.resources.html||(window.gigya._.plugins.resources.html={}),window.gigya._.plugins.resources.html.profilePhoto||(window.gigya._.plugins.resources.html.profilePhoto={}),t(window.gigya._.plugins.profilePhoto,n),t(window.gigya._.plugins.resources.css.profilePhoto,r),t(window.gigya._.plugins.resources.html.profilePhoto,i,a,s,l),window.gigya._.UI.attachPlugin(n.MyPhotoPlugin,"accounts",n.MyPhotoPlugin.PLUGIN_NAME,"showMyPhotoUI")}).call(this,o(0).__assign)},277:function(t,e,o){Object.defineProperty(e,"__esModule",{value:!0});var n,r,i,a,s,l=o(0),p=o(278);!function(t){t[t.NotStarted=0]="NotStarted",t[t.InProgress=1]="InProgress",t[t.Done=2]="Done",t[t.Error=3]="Error"}(n=e.ServerStates||(e.ServerStates={})),e.IframeUploadInfo={setDimentionsDelay:500,uploadCheckInterval:500,uploading:"data-upload-status"},function(t){t[t.display=0]="display",t[t.upload=1]="upload"}(r=e.ProfilePhotoModes||(e.ProfilePhotoModes={})),function(t){t[t.formSubmit=0]="formSubmit",t[t.serverApi=1]="serverApi"}(i=e.ProfilePhotoUploadModes||(e.ProfilePhotoUploadModes={})),function(t){t[t.fileSizeError=0]="fileSizeError",t[t.serverError=1]="serverError",t[t.none=2]="none"}(a=e.ProfilePhotoErrorType||(e.ProfilePhotoErrorType={})),function(t){t[t.upload=0]="upload",t[t.update=1]="update"}(s=e.ProfilePhotoEditModes||(e.ProfilePhotoEditModes={})),e.ForEach=function(t,e){for(var o=0;o<t.length;++o)e(t[o],o,t)};var u=function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._photoDimensions={width:120,height:120},e._currentErrorType=a.none,e._currnetErrorText="",e._isPhotoUploaded=!0,e._pluginInitialized=!1,e._nextServerQueryId=0,e.onUserStateChange=function(t){return e.userStateChanged(t)},e._nextGeneratedId=0,e._lastQueryId=0,e._uploadMode=i.serverApi,e._editMode=s.upload,e._imageBase=window.gigya._.getCdnResource("/gs/i/profilePhoto"),e}return l.__extends(o,t),o.injectionInfo=function(){return{name:"profilePhoto",namespace:"accounts",methodName:"showMyPhotoUI",jsName:"gigya.services.accounts.plugins.profilePhoto"}},o.prototype.getConfig=function(){return{requiredParams:[],defaultParams:{width:"120",height:"120",cssPrefix:"",mode:r[r.display],tooltipTimeout:o.TOOLTIP_TIMEOUT},hasMobileUI:!0,allowModal:!1}},o.prototype.validateUserInputParams=function(){"display"==this.params.mode||"upload"==this.params.mode?this._pluginMode=r[this.params.mode]:this._pluginMode=r.display;var t=!isNaN(parseFloat(this.params.width)),e=!isNaN(parseFloat(this.params.height.toString()));t||(this.params.width="120"),e||(this.params.height="120")},o.prototype.init=function(t){this._loadedCallback=t,o.UPDATE_PHOTO_TEXT=this.getText("profilePhoto_update"),o.UPLOAD_PHOTO_TEXT=this.getText("profilePhoto_upload"),o.FULL_DEFAULT_IMAGE_PATH=this._imageBase+"/photo_default.png",this.validateUserInputParams();var e=window.gigya.utils.templates.fill(this.getCss().style,{scriptBase:this._imageBase});window.gigya._.plugins.utils.css.addCss(e,this.params.cssPrefix),this.checkForProfilePhoto()},o.prototype.resetContainer=function(){this.container.innerHTML=this.getControlHtml(),this._pluginWrapperDiv=window.gigya.utils.DOM.getElementsByClass(this.container,"gigya-myPhoto-profile-box-wrapper")[0],this._pluginWrapperDiv.style.width=this.params.width+"px",this._pluginWrapperDiv.style.height=this.params.height+"px"},o.prototype.checkForProfilePhoto=function(){var t=this,e={callback:this.prepareCallback(function(e){return t.onAccountInfoCheckCompleted(e)}),include:"profile,data",context:this};window.gigya.accounts.getAccountInfo(e)},o.prototype.onAccountInfoCheckCompleted=function(t){var e=t.context;0!==t.errorCode&&e.params.regToken?e.onAccountInfoErrorWithRegToken():(0===t.errorCode?e.onAccountInfoSuccess(t):e.onAccountInfoError(t),this.getImageDimensions(e.afterImageDimensionsRetreival))},o.prototype.afterImageDimensionsRetreival=function(){this.render(),this._loadedCallback(),this._pluginInitialized=!0},o.prototype.onAccountInfoSuccess=function(t){this._currentPhotoURL=void 0,this._isPhotoUploaded=!1,(t.profile.photoURL||t.profile.thumbnailURL)&&this.updatePluginState(),this.setProfilePhotoURL(t)},o.prototype.getProfilePhotoURL=function(){return this._currentPhotoURL||o.FULL_DEFAULT_IMAGE_PATH},o.prototype.setProfilePhotoURL=function(t){var e;window.gigya.localInfo.isIE8&&t.profile.thumbnailURL?e=t.profile.thumbnailURL:t.profile.photoURL?e=t.profile.photoURL:t.profile.thumbnailURL&&(e=t.profile.thumbnailURL),e&&(this._currentPhotoURL=window.gigya.global.getPhotoURL(e))},o.prototype.updatePluginState=function(){this._editMode=s.update,this._isPhotoUploaded=!0},o.prototype.onAccountInfoError=function(t){this._currentPhotoURL=void 0,this._isPhotoUploaded=!1,this._pluginMode=r.display},o.prototype.onAccountInfoErrorWithRegToken=function(){this.getProfilePhotoUsingRegToken()},o.prototype.setPhotoImage=function(){this._imageElement.style.background="#FFF url('"+this.getProfilePhotoURL()+"') 50% 50% no-repeat",this.arePhotoDimensionsWider(this._photoDimensions)&&(this._imageElement.style.backgroundSize="Contain")},o.prototype.render=function(){this.resetContainer();var t=this._nextGeneratedId++;this._imageElement=this.container.querySelector("#"+this.containerID+" ."+o.IMAGE_CLASS),this.setPhotoImage(),this._pluginMode===r.upload&&(this.getDOMElements(t),this.setDOMEvents(),this._isPhotoUploaded&&window.gigya.pluginUtils.DOM.hideElement(this._iconElement),this.createIFrameElement(),this.createInputFileElement(),this.createFormElement(),this.registerLocalEvents()),this.registerToGlobalEvents()},o.prototype.getDOMElements=function(t){this.innerContainer=this.container.firstChild,this._formWrapper=window.gigya.utils.DOM.getElementsByClass(this.container,"gigya-myPhoto-form-wrapper")[0],this._infoTooltipElement=document.querySelector("#"+this.containerID+" .gigya-myPhoto-tooltip-wrap"),this._iconElement=document.querySelector("#"+this.containerID+" .gigya-myPhoto-status-icon"),this._tooltipContainer=window.gigya.utils.DOM.getElementsByClass(this.container,"gigya-myPhoto-tooltip")[0],this._tooltipTextContainer=window.gigya.utils.DOM.getElementsByClass(this.container,"gigya-myPhoto-tooltip-text-wrap")[0],this._uploadForm=document.querySelector("#"+this.containerID+" form"),this._isFilesFeatureSupported=window.gigya.localInfo.isBrowserSupportsFilesAPI,this._uploadTextElement=document.querySelector("#"+this.containerID+" .gigya-myPhoto-upload-button"),this._uploadIframeID=this.params.containerID+"_upload"+t+"_target",this._formID=this.params.containerID+"_upload"+t+"_form"},o.prototype.setDOMEvents=function(){var t=this;this._fileInputClicked=function(){return t.onFileInputClicked()},this._fileInputChanged=function(){return t.onFileInputChange()},this._iconMouseHover=function(){return t.onIconHovered()}},o.prototype.registerLocalEvents=function(){var t=this;this.listenOnIframe=function(){var o=t._uploadIframe.getAttribute(e.IframeUploadInfo.uploading),r=n[o];r!==t._photoProfileState&&t.onServerQueryEnd(t._lastQueryId,r)},window.gigya.utils.DOM.addEventListener(this._fileInput,"change",this._fileInputChanged),window.gigya.utils.DOM.addEventListener(this._fileInput,"click",this._fileInputClicked),window.gigya.utils.DOM.addEventListener(this._iconElement,"mouseover",this._iconMouseHover)},o.prototype.updateUserPhoto=function(t){this._editMode=s.update;this.arePhotoDimensionsWider(t.dimensions);this._currentPhotoURL=t.photoURL,this._photoDimensions=t.dimensions,this.setPhotoImage(),this._editMode==s.update&&this._iconElement&&window.gigya.pluginUtils.DOM.hideElement(this._iconElement),this._uploadTextElement.innerHTML=o.UPDATE_PHOTO_TEXT,this.toggleErrorIndication(!1)},o.prototype.registerToGlobalEvents=function(){this.addGlobalEventHandlers({onLogin:this.onUserStateChange,onLogout:this.onUserStateChange}),this.addGlobalEventHandler(o.USER_INFO_CHANGE_EVENT,this.onUserStateChange)},o.prototype.unregisterToGlobalEvents=function(){this.removeGlobalEventHandlers({onLogin:this.onUserStateChange,onLogout:this.onUserStateChange}),this.removeGlobalEventHandler(o.USER_INFO_CHANGE_EVENT,this.onUserStateChange)},o.prototype.unregisterLocalEvents=function(){var t=this;window.gigya.utils.DOM.removeEventListener(this._iconElement,"mouseover",function(e){t.displayTooltip()}),window.gigya.utils.DOM.removeEventListener(this._fileInput,"change",this._fileInputChanged),window.gigya.utils.DOM.removeEventListener(this._fileInput,"click",this._fileInputClicked)},o.prototype.onFileInputClicked=function(){return this.toggleErrorIndication(!1),!0},o.prototype.onIconHovered=function(){""==this._currnetErrorText&&(this._currnetErrorText=this._fileSizeErrorText,this.displayTooltip())},o.prototype.onFileInputChange=function(){return l.__awaiter(this,void 0,void 0,function(){var t;return l.__generator(this,function(e){switch(e.label){case 0:return this._isFilesFeatureSupported?this._fileInput.files[0].size>o.MAX_IMAGE_BYTE_SIZE?(this._fileInput.value=null,this._currentErrorType=a.fileSizeError,this._currnetErrorText=this._fileSizeErrorText,this.toggleErrorIndication(!0),[3,3]):[3,1]:[3,4];case 1:return t=this,[4,p.getImageBase64(this._fileInput.files[0],this.params.fixImageOrientation)];case 2:t._base64PhotoData=e.sent(),this.submitPhoto(),e.label=3;case 3:return[3,5];case 4:this._uploadMode=i.formSubmit,this.submitPhoto(),e.label=5;case 5:return[2]}})})},o.prototype.startServerQuery=function(){return this._photoProfileState=n.InProgress,this._lastQueryId=++this._nextServerQueryId,this._uploadIframe.setAttribute(e.IframeUploadInfo.uploading,n[this._photoProfileState]),this.uploadCheckInterval||(this.uploadCheckInterval=window.setInterval(this.listenOnIframe,e.IframeUploadInfo.uploadCheckInterval)),this._lastQueryId},o.prototype.onServerQueryEnd=function(t,e,o){t===this._nextServerQueryId?this.serverQueryDone(e,o):this.warn("Ignoring server response #"+t)},o.prototype.stopUploadCheck=function(){this.uploadCheckInterval&&(window.clearInterval(this.uploadCheckInterval),this.uploadCheckInterval=0)},o.prototype.submitPhoto=function(){this._uploadMode==i.formSubmit?this.sendPhotoWithFormSubmit():this.sendPhotoWithServerApi()},o.prototype.sendPhotoWithFormSubmit=function(){this.startServerQuery(),this._lastResponseId=this._uploadIframeID+"_"+this._lastQueryId;var t="https://"+window.gigya._.getApiDomain("accounts")+"/accounts.uploadProfilePhoto?publish=true&context="+this._lastResponseId+"&saveResponseID="+this._lastResponseId+"&"+window.gigya.utils.keyValue.serialize(this.getServerParameters());this._uploadForm.action=t,this._uploadForm.target=this._uploadIframeID,this.showLoader(this.innerContainer),window.gigya._.plugins.utils.DOM.setAttribute(this._uploadForm,"encType","multipart/form-data"),this._uploadForm.submit()},o.prototype.sendPhotoWithServerApi=function(){var t=this.getServerParameters(),e={photoBytes:this._base64PhotoData,publish:!0,callback:this.onUploadSavedResponse.bind(this)},o=window.gigya.utils.object.merge([t,e]);o.regToken||delete o.regToken,this.showLoader(this.innerContainer),window.gigya.accounts.setProfilePhoto(o)},o.prototype.getServerParameters=function(){var t=window.gigya.utils.object.extractProperties(this.params,{},"APIKey|cid|oauth_token|login_token|source|sourceData|regToken");t.authMode=t.oauth_token?"token":"cookie",t.APIKey||(t.APIKey=window.gigya.thisScript.APIKey);var e=window.gigya._.apiAdapters.web;return e&&(t.login_token=e.tokenStore.get(t.APIKey),t.gmid=window.gigya._.apiAdapter.getGmidTicket()),t},o.prototype.serverQueryDone=function(t,e){var o=this;this.stopUploadCheck();var n=window.gigya.utils.object.removeUndefined(this.getServerParameters());n.saveResponseID=this._lastResponseId,n.noAuth=!0,delete n.login_token,delete n.regToken,window.gigya._.apiAdapter.sendRequest("socialize.getSavedResponse",n,function(t){return o.onUploadSavedResponse(t)},{jsSdkRequestId:this._lastResponseId})},o.prototype.onUploadSavedResponse=function(t){switch(t.errorCode){case 0:window.gigya.accounts.getAccountInfo({callback:this.onUpdatedPhotoCompleted,context:this,include:"profile,data"});break;case 400006:case 400096:this._currentErrorType=a.fileSizeError,this._currnetErrorText=this._fileSizeErrorText,this.toggleErrorIndication(!0);break;default:this._currentErrorType=a.serverError,this._currnetErrorText=o.SERVER_ERROR_TEXT,this.toggleErrorIndication(!0)}},o.prototype.onUpdatedPhotoCompleted=function(t){var e=t.context;t.profile?(e.setProfilePhotoURL(t),e._editMode=s.update,e.getImageDimensions(e.onPhotoDimensionsRetreived)):e.getProfilePhotoUsingRegToken()},o.prototype.onPhotoDimensionsRetreived=function(){this._pluginInitialized&&(this.hideLoader(this.innerContainer),this.toggleErrorIndication(!1),this._uploadTextElement.innerHTML=o.UPDATE_PHOTO_TEXT,window.gigya.events.global.dispatch({isInternal:!1,eventName:o.EVENT_TYPES.onUserInfoChanged},{sourceData:{photoURL:this.getProfilePhotoURL(),dimensions:this._photoDimensions}}),this._editMode==s.upload&&window.gigya.utils.DOM.removeClassFromElement(this.innerContainer,o.CLASSES_STATES.upload),window.gigya.utils.DOM.addClassToElement(this.innerContainer,o.CLASSES_STATES.update),this._editMode=s.update)},o.prototype.setImageDimensions=function(t){this._photoDimensions.width=t.naturalWidth,this._photoDimensions.height=t.naturalHeight,t=t.onload=t.onerror=null},o.prototype.getProfilePhotoUsingRegToken=function(){var t=this,e=this.getServerParameters();e.type=window.gigya.localInfo.isIE8?"thumbnail":"orig",e.ts=(new Date).getTime();var n=this.buildUrlForProfilePhotoAPI(e),r=new Image,i=this;r.onload=this.prepareCallback(function(){i.setImageDimensions(r),i._currentPhotoURL=n,i.onPhotoDimensionsRetreived(),i._pluginInitialized||i.afterImageDimensionsRetreival()}),r.onerror=function(){i._pluginInitialized?(i._isPhotoUploaded=!1,i._currentErrorType=a.serverError,i._currnetErrorText=i.getServerErrorText("Profile photo inaccesible."),t.toggleErrorIndication(!0),i._editMode===s.upload?(window.gigya.utils.DOM.addClassToElement(i.innerContainer,o.CLASSES_STATES.upload),window.gigya.pluginUtils.DOM.showElement(i._iconElement)):window.gigya.utils.DOM.addClassToElement(i.innerContainer,o.CLASSES_STATES.update),window.gigya.pluginUtils.DOM.showElement(i._uploadTextElement)):(i._currentPhotoURL=i._imageBase+"/photo_default.png",i.getImageDimensions(i.afterImageDimensionsRetreival),i._isPhotoUploaded=!1),r=r.onload=r.onerror=null},r.src=n},o.prototype.buildUrlForProfilePhotoAPI=function(t){return(t.login_token||t.regToken?"https":window.gigya.localInfo.protocol)+"://"+window.gigya._.getApiDomain("accounts")+"/accounts.getProfilePhoto?"+window.gigya.utils.keyValue.serialize(t)},o.prototype.getImageDimensions=function(t){var e=this,n=new Image;n.onload=this.prepareCallback(function(){e.setImageDimensions(n),t.apply(e)}),n.onerror=function(){n=n.onload=n.onerror=null,e._currentErrorType=a.serverError,e._currnetErrorText=e.getServerErrorText("Profile photo inaccessible."),e.toggleErrorIndication(!0),e._editMode===s.upload?(window.gigya.utils.DOM.addClassToElement(e.innerContainer,o.CLASSES_STATES.upload),window.gigya.pluginUtils.DOM.showElement(e._iconElement)):window.gigya.utils.DOM.addClassToElement(e.innerContainer,o.CLASSES_STATES.update),window.gigya.pluginUtils.DOM.showElement(e._uploadTextElement),t(e)},n.src=this.getProfilePhotoURL()},o.prototype.arePhotoDimensionsWider=function(t){return t.width>parseInt(this.params.width)||t.height>parseInt(this.params.height)},o.prototype.dispose=function(){this.unregisterToGlobalEvents(),t.prototype.dispose.call(this)},o.prototype.getControlHtml=function(){var t;if(this._fileSizeErrorText=this.getText("profilePhoto_fileSizeInfo"),this.container.innerHTML="",this._pluginMode==r.upload){var e;e=this._isPhotoUploaded?o.UPDATE_PHOTO_TEXT:o.UPLOAD_PHOTO_TEXT;var n=this._editMode==s.upload?"gigya-myPhoto-status-upload":"gigya-myPhoto-status-uploaded";t=window.gigya.utils.templates.fill(this.getTemplates().upload,{tooltip:this._fileSizeErrorText,uploadText:e,editClass:n})}else t=window.gigya.utils.templates.fill(this.getTemplates().display,{});return t},o.prototype.createIFrameElement=function(){this._uploadIframe=document.createElement("iframe"),this._uploadIframe.style.display="none",this._uploadIframe.id=this._uploadIframeID,this._uploadIframe.setAttribute("name",this._uploadIframeID),this._uploadIframe.setAttribute(e.IframeUploadInfo.uploading,n[n.NotStarted]),this._uploadIframe.setAttribute("onload","this.setAttribute('"+e.IframeUploadInfo.uploading+"','"+n[n.Done]+"')"),this.container.appendChild(this._uploadIframe)},o.prototype.createFormElement=function(){this._uploadForm=document.createElement("form"),this._uploadForm.className="gigya-myPhoto-uploadForm",this._uploadForm.enctype="multipart/form-data",this._uploadForm.method="POST",this._uploadForm.action="",this._uploadForm.target=this._uploadIframeID,this._uploadForm.appendChild(this._fileInput),this._formWrapper.appendChild(this._uploadForm)},o.prototype.createInputFileElement=function(){this._fileInput=document.createElement("input"),this._fileInput.type="file",this._fileInput.title="",this._fileInput.accept="image/*",this._fileInput.name="_profilePhoto",this._fileInput.className="gigya-myPhoto-upload",this._fileInput.title=window.gigya.pluginUtils.lang.getLocalizedText("gigya.services.accounts.plugins.screenSet.js","no_file_chosen",this.params.lang)},o.prototype.userStateChanged=function(t){t.eventName==o.EVENT_TYPES.onUserInfoChanged?this.updateUserPhoto(t.sourceData):t.eventName==o.EVENT_TYPES.onlogin?(this.validateUserInputParams(),this.checkForProfilePhoto()):this.resetPlugin()},o.prototype.resetPlugin=function(){this._pluginMode=r.display,this._editMode=s.upload,this._currentPhotoURL=void 0,this.render()},o.prototype.showLoader=function(t){this._editMode==s.upload?window.gigya.utils.DOM.removeClassFromElement(t,o.CLASSES_STATES.upload):window.gigya.utils.DOM.removeClassFromElement(t,o.CLASSES_STATES.update),window.gigya.utils.DOM.addClassToElement(t,o.CLASSES_STATES.loading),window.gigya.pluginUtils.DOM.hideElement(this._uploadTextElement),window.gigya.pluginUtils.DOM.hideElement(this._iconElement)},o.prototype.hideLoader=function(t){window.gigya.utils.DOM.removeClassFromElement(t,o.CLASSES_STATES.loading),this._editMode==s.upload?window.gigya.utils.DOM.addClassToElement(t,o.CLASSES_STATES.upload):window.gigya.utils.DOM.addClassToElement(t,o.CLASSES_STATES.update),window.gigya.pluginUtils.DOM.showElement(this._uploadTextElement)},o.prototype.displayTooltip=function(){this._tooltipTextContainer.innerHTML=this._currnetErrorText,window.gigya.pluginUtils.DOM.showElement(this._infoTooltipElement);var t=this._infoTooltipElement;if(this._currentErrorType==a.none)return setTimeout(function(){window.gigya.pluginUtils.DOM.hideElement(t)},o.TOOLTIP_TIMEOUT),void(this._currnetErrorText="")},o.prototype.toggleErrorIndication=function(t){t?(this._editMode==s.update?window.gigya.utils.DOM.removeClassFromElement(this.innerContainer,o.CLASSES_STATES.update):window.gigya.utils.DOM.removeClassFromElement(this.innerContainer,o.CLASSES_STATES.upload),window.gigya.utils.DOM.addClassToElement(this.innerContainer,o.CLASSES_STATES.error),window.gigya.pluginUtils.DOM.showElement(this._iconElement),this.displayTooltip()):(window.gigya.utils.DOM.removeClassFromElement(this.innerContainer,o.CLASSES_STATES.error),this._editMode==s.update?(window.gigya.utils.DOM.addClassToElement(this.innerContainer,o.CLASSES_STATES.update),window.gigya.pluginUtils.DOM.hideElement(this._iconElement)):window.gigya.utils.DOM.addClassToElement(this.innerContainer,o.CLASSES_STATES.upload),window.gigya.pluginUtils.DOM.hideElement(this._infoTooltipElement)),this.hideLoader(this.innerContainer)},o.prototype.getServerErrorText=function(t){return"<b> "+t+"</b>"},o.PLUGIN_NAME="profilePhoto",o.MAX_IMAGE_BYTE_SIZE=6291456,o.TOOLTIP_TIMEOUT=3e3,o.SERVER_ERROR_TEXT="An error has occurred while trying to upload photo",o.USER_INFO_CHANGE_EVENT="onUserInfoChanged",o.IMAGE_CLASS="gigya-myPhoto-profile-image",o.DEFAULT_IMAGE_NAME="photo_default.png",o.CLASSES_STATES={upload:"gigya-myPhoto-status-upload",update:"gigya-myPhoto-status-uploaded",error:"gigya-myPhoto-status-error",loading:"gigya-myPhoto-status-loading"},o.EVENT_TYPES={onlogin:"login",onUserInfoChanged:"UserInfoChanged",onlogout:"logout"},o}(window.gigya._.plugins.BasePlugin);e.MyPhotoPlugin=u},278:function(t,e){function o(t){return t.split(",")[1]}Object.defineProperty(e,"__esModule",{value:!0}),e.getImageBase64=function(t,e){return void 0===e&&(e=!1),new gigya.Promise(function(n){var r=new FileReader;r.onload=function(t){var i=r.result.toString(),a=o(i);e?function(t,e,n){if(isNaN(e)||e<2)n(o(t));else{var r=new Image;r.onload=function(){var t=r.width,i=r.height,a=document.createElement("canvas"),s=a.getContext("2d");switch(4<e&&e<9?(a.width=i,a.height=t):(a.width=t,a.height=i),e){case 2:s.transform(-1,0,0,1,t,0);break;case 3:s.transform(-1,0,0,-1,t,i);break;case 4:s.transform(1,0,0,-1,0,i);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,i,0);break;case 7:s.transform(0,-1,-1,0,i,t);break;case 8:s.transform(0,-1,1,0,0,t)}s.drawImage(r,0,0),n(o(a.toDataURL("image/jpeg")))},r.src=t}}(i,function(t){var e=new DataView(t);if(65496!=e.getUint16(0,!1))return-2;for(var o=e.byteLength,n=2;n<o;){if(e.getUint16(n+2,!1)<=8)return-1;var r=e.getUint16(n,!1);if(n+=2,65505==r){if(1165519206!=e.getUint32(n+=2,!1))return-1;var i=18761==e.getUint16(n+=6,!1);n+=e.getUint32(n+4,i);var a=e.getUint16(n,i);n+=2;for(var s=0;s<a;s++)if(274==e.getUint16(n+12*s,i))return e.getUint16(n+12*s+8,i)}else{if(65280!=(65280&r))break;n+=e.getUint16(n,!1)}}return-1}(function(t){for(var e=window.atob(t),o=e.length,n=new Uint8Array(o),r=0;r<o;r++)n[r]=e.charCodeAt(r);return n.buffer}(a)),n):n(a)},r.readAsDataURL(t)})}},279:function(t,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.style=o(280)},280:function(t,e){t.exports=".gigya-myPhoto-profile-box-wrapper {\r\n    border-radius: 3px;\r\n    border: 1px solid #b6bdc5;\r\n    position: relative;\r\n    margin-left: 10px;\r\n    margin-top: 30px;\r\n}\r\n\r\n\r\n.gigya-myPhoto-profile-box-wrapper .gigya-myPhoto-status-icon {\r\n    background: url('$scriptBase/info_tooltip_active.png') no-repeat;\r\n    top: 4px;\r\n    left: 4px;\r\n    width: 14px;\r\n    height: 14px;\r\n    position: absolute;\r\n    font-family: Arial;\r\n    font-weight: 500;\r\n    color: #5a5a5a;\r\n    text-align: center;\r\n    font-size: 15px;\r\n    line-height: 16px;\r\n    z-index: 100000000;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper .gigya-myPhoto-status-icon .gigya-myPhoto-tooltip-wrap {\r\n    display: block;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper .gigya-myPhoto-profile-image { /*class to override by customer*/\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper .gigya-myPhoto-profile-image .gigya-myPhoto-profile-image-default {\r\n    background: #FFF url('$scriptBase/photo_default.png') 50% 50% no-repeat;\r\n}\r\n\r\n\r\n.gigya-myPhoto-profile-box-wrapper .gigya-myPhoto-loading-icon {\r\n    background: url('$scriptBase/loading.gif') 50% 50% no-repeat;\r\n    bottom: 9px;\r\n    width: 30px;\r\n    height: 30px;\r\n    left: 50%;\r\n    margin-left: -15px;\r\n    position: absolute;\r\n    display: none;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper input.gigya-myPhoto-upload {\r\n    position: absolute;\r\n    bottom: 0;\r\n    right: 0;\r\n    margin: 0;\r\n    padding: 0;\r\n    font-size: 20px;\r\n    cursor: pointer;\r\n    width: 170%;\r\n    height: 100%;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper span.gigya-myPhoto-upload-button {\r\n    background-color: #FFFFFF;\r\n    opacity: 0.9;\r\n    filter: alpha(opacity=90);\r\n    bottom: 0;\r\n    width: 100%;\r\n    left: 0;\r\n    position: absolute;\r\n    font-family: Arial;\r\n    letter-spacing: normal;\r\n    font-weight: 500;\r\n    color: #5a5a5a;\r\n    cursor: pointer;\r\n    display: none;\r\n    text-align: center;\r\n    font-size: 15px;\r\n    line-height: 15px;\r\n    padding: 1px 0 4px;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper .gigya-myPhoto-tooltip-wrap {\r\n    display: none;\r\n    position: relative;\r\n    top: -4px;\r\n    left: -4px;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper .gigya-myPhoto-tooltip-wrap .gigya-myPhoto-tooltip {\r\n    /*background: url('$scriptBase/tooltip.png') -28px 0;*/\r\n    height: 33px;\r\n    border: 1px;\r\n    border-style: Solid;\r\n    border-color: #BFCFDA;\r\n    border-radius: 2px;\r\n    background-color: #F3F5F6;\r\n    width: 270px;\r\n    position: relative;\r\n    top: -38px;\r\n    left: -2px;\r\n    text-align: center;\r\n}\r\n\r\n.gigya-myPhoto-arrow {\r\n    background: url('$scriptBase/tooltip_arrow.png');\r\n    width: 18px;\r\n    height: 10px;\r\n    position: absolute;\r\n    top: -4px;\r\n    left: 2px;\r\n    z-index: 9999999999999999999999999;\r\n}\r\n\r\n.gigya-myPhoto-tooltip-text-wrap b {\r\n    font-weight: bold;\r\n    font-size: 12px;\r\n}\r\n\r\ndiv.gigya-myPhoto-tooltip-text-wrap {\r\n    position: absolute;\r\n    left: 4%;\r\n    top: 22%;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper .gigya-myPhoto-tooltip-wrap .gigya-myPhoto-tooltip div {\r\n    font-weight: 500;\r\n    color: #5a5a5a;\r\n    font-family: Arial;\r\n    font-size: 12px;\r\n    line-height: 16px;\r\n    padding: 0;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-upload span.gigya-myPhoto-upload-button {\r\n    display: block;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-loading .gigya-myPhoto-profile-image {\r\n    opacity: 0.1;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-loading .gigya-myPhoto-loading-icon {\r\n    display: block;\r\n    top: 40%;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-loading .gigya-myPhoto-status-icon {\r\n    display: none;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-error {\r\n    border-color: #e76468;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-error .gigya-myPhoto-status-icon {\r\n        background: url('$scriptBase/info_tooltip_error.png');\r\n        display: block;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-error span.gigya-myPhoto-upload-button,\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-error .gigya-myPhoto-tooltip-wrap {\r\n        display: block;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-upload .gigya-myPhoto-tooltip-wrap {\r\n    display: none;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-uploaded .gigya-myPhoto-status-icon {\r\n    display: none;\r\n}\r\n\r\n.gigya-myPhoto-profile-box-wrapper.gigya-myPhoto-status-uploaded span.gigya-myPhoto-upload-button {\r\n    display: block;\r\n    cursor: pointer;\r\n}\r\n\r\n.gigya-myPhoto-uploadForm {\r\n    opacity: 0;\r\n    filter: alpha(opacity=0);\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.gigya-myPhoto-form-wrapper {\r\n    filter: alpha(opacity=0);\r\n    z-index: 999;\r\n    position: absolute;\r\n    height: 100%;\r\n    width: 95%;\r\n    top: 0;\r\n}\r\n"},281:function(t,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.display=o(282)},282:function(t,e){t.exports='<div class="gigya-myPhoto-profile-box-wrapper">\r\n    <div class="gigya-myPhoto-profile-image"></div>\r\n</div>\r\n'},283:function(t,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.tooltipFileSize=o(284)},284:function(t,e){t.exports='<span id="errorContainer">\r\n    $tooltip\r\n</span>'},285:function(t,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.tooltipServerError=o(286)},286:function(t,e){t.exports="<span>\r\n    <strong>$serverError</strong>\r\n</span>"},287:function(t,e,o){Object.defineProperty(e,"__esModule",{value:!0}),e.upload=o(288)},288:function(t,e){t.exports='<div class="gigya-myPhoto-profile-box-wrapper $editClass">\r\n    \x3c!-- .status-upload | .status-loading | .status-error | .status-uploaded --\x3e\r\n    <div class="gigya-myPhoto-status-icon">\r\n        <div class="gigya-myPhoto-tooltip-wrap">\r\n            <div class="gigya-myPhoto-tooltip">\r\n                <div class="gigya-myPhoto-tooltip-text-wrap">$tooltip</div>\r\n            </div>\r\n            <div class="gigya-myPhoto-arrow">\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="gigya-myPhoto-profile-image"></div>\r\n    <div class="gigya-myPhoto-upload-button-wrap">\r\n        <span class="gigya-myPhoto-upload-button">$uploadText</span>\r\n    </div>\r\n    <div class="gigya-myPhoto-loading-icon"></div>\r\n    <div class="gigya-myPhoto-form-wrapper">\r\n\r\n    </div>\r\n</div>'}});