!function(e){var n={};function t(a){if(n[a])return n[a].exports;var i=n[a]={i:a,l:!1,exports:{}};return e[a].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(a,i,function(n){return e[n]}.bind(null,i));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=382)}({382:function(e,n){var t;window.Backplane=window.Backplane||((t=function(e){if(Backplane.getChannelID())e();else{var n=Backplane.onInit;Backplane.onInit=function(){n(),e()}}}).log=function(e){window.console&&window.console.log&&console.log("Backplane: "+e)},t.warn=function(e){window.console&&window.console.warn&&console.warn("Backplane WARNING: "+e)},t.error=function(e){window.console&&window.console.error&&console.error("Backplane ERROR: "+e)},t.version="1.2.7",t.channelByBus={},t.config={},t.initialized=!1,t.runRequests=!1,t.firstFrameReceived=!1,t.cachedMessages={},t.cachedMessagesIndex=[],t.cacheMax=5,t.subscribers={},t.serverChannel=!0,t.awaiting={since:0,until:0,queue:[]},t.intervals={min:1,frequent:5,regular:60,slowdown:120},t.onInit=function(){},t),Backplane.init=function(e){return e=e||{},!(this.initialized||!e.serverBaseURL||!e.busName)&&(this.initialized=!0,this.timers={},this.config=e,this.config.serverBaseURL=this.normalizeURL(e.serverBaseURL),this.channelByBus=this.getCookieChannels(),this.cacheMax=e.cacheMax||this.cacheMax,void 0!==e.serverChannel&&(this.serverChannel=e.serverChannel),void 0===this.config.channelExpires&&((e=new Date).setFullYear(e.getFullYear()+5),this.config.channelExpires=e.toGMTString()),this.renameOldCache(),this.getChannelName()?this.finishInit(!1):(this.invalidateCache(),this.fetchNewChannel()),!0)},Backplane.renameOldCache=function(){if(window.localStorage){var e=localStorage.getItem("cacheExpires"),n=localStorage.getItem("cachedMessages"),t=localStorage.getItem("cachedMessagesIndex");e&&n&&t&&(localStorage.setItem("backplaneCacheExpires",e),localStorage.setItem("backplaneCachedMessages",n),localStorage.setItem("backplaneCachedMessagesIndex",t),localStorage.removeItem("cacheExpires"),localStorage.removeItem("cachedMessages"),localStorage.removeItem("cachedMessagesIndex"))}},Backplane.subscribe=function(e){if(!this.initialized)return!1;this.checkSubscribers()||(this.runRequests=!0,this.request());var n=(new Date).valueOf()+Math.random();if(this.subscribers[n]=e,this.firstFrameReceived)for(var t=0;t<this.cachedMessagesIndex.length;t++)e(this.cachedMessages[this.cachedMessagesIndex[t]]);return n},Backplane.unsubscribe=function(e){if(!this.initialized||!e)return!1;delete this.subscribers[e],this.checkSubscribers()||(this.runRequests=!1)},Backplane.getChannelID=function(){return!!this.initialized&&this.config.channelID},Backplane.expectMessages=function(e){this.expectMessagesWithin(60,e)},Backplane.expectMessagesWithin=function(e,n){if(!this.initialized||!e)return!1;this.awaiting.since=this.getTS(),this.awaiting.interval=e,this.awaiting.nonstop=!n,n&&(n="string"==typeof n?[n]:n,this.awaiting.queue.push(n));var t=this.awaiting.since+e;t>this.awaiting.until&&(this.awaiting.until=t),this.request()},Backplane.finishInit=function(e){void 0===e?this.error("finishInit: server failed to return a new channel; stopping the request loop"):(e&&(this.channelByBus[this.config.busName]=e),this.setCookieChannels(),this.config.channelName=this.getChannelName(),this.config.channelID=this.generateChannelID(),this.onInit(),this.request())},Backplane.generateChannelID=function(){return this.config.serverBaseURL+"/bus/"+this.config.busName+"/channel/"+this.config.channelName},Backplane.getChannelName=function(){if(!this.initialized)return!1;if(!this.channelByBus[this.config.busName]||"false"===this.channelByBus[this.config.busName]){if(this.serverChannel)return!1;this.invalidateCache(),this.channelByBus[this.config.busName]=(new Date).valueOf().toString()+Math.random().toString().substr(2,5),this.setCookieChannels()}return this.channelByBus[this.config.busName]},Backplane.getTS=function(){return Math.round((new Date).valueOf()/1e3)},Backplane.checkSubscribers=function(){for(var e in this.subscribers)return!0;return!1},Backplane.getCookieChannels=function(){if(!(n=(document.cookie||"").match(/backplane-channel=(.*?)(?:$|;)/))||!n[1])return{};for(var e={},n=n[1].split("|"),t=0;t<n.length;t++){var a=n[t].split(":");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e},Backplane.setCookieChannels=function(){var e,n=[];for(e in this.channelByBus)this.channelByBus.hasOwnProperty(e)&&n.push(encodeURIComponent(e)+":"+encodeURIComponent(this.channelByBus[e]));document.cookie="backplane-channel="+n.join("|")+";expires="+this.config.channelExpires+";path=/"},Backplane.resetCookieChannel=function(){delete this.channelByBus[this.config.busName],this.invalidateCache(),this.setCookieChannels(),this.serverChannel?this.fetchNewChannel():(this.config.channelName=this.getChannelName(),this.config.channelID=this.generateChannelID())},Backplane.fetchNewChannel=function(){for(var e=document.getElementById("fetchChannelId");e&&e.parentNode;){for(var n in e.parentNode.removeChild(e),e)delete e[n];e=document.getElementById("fetchChannelId")}(e=document.createElement("script")).src=this.config.serverBaseURL+"/bus/"+this.config.busName+"/channel/new?callback=Backplane.finishInit&rnd="+Math.random(),e.type="text/javascript",e.id="fetchChannelId",(n=document.getElementsByTagName("script")[0]).parentNode.insertBefore(e,n)},Backplane.invalidateCache=function(){Backplane.log("removing cached backplane messages"),this.cachedMessages={},this.cachedMessagesIndex=[],window.localStorage&&(localStorage.removeItem("backplaneCacheExpires"),localStorage.removeItem("backplaneCachedMessages"),localStorage.removeItem("backplaneCachedMessagesIndex"))},Backplane.normalizeURL=function(e){return e.replace(/^\s*(https?:\/\/)?(.*?)[\s\/]*$/,function(e,n,t){return(n||window.location.protocol+"//")+t})},Backplane.calcTimeout=function(){var e;if((e=this.getTS())<this.awaiting.until){if(!this.awaiting.nonstop&&!this.awaiting.queue.length)return this.awaiting.until=e,this.calcTimeout();e-=this.awaiting.since;var n=this.intervals.frequent-this.intervals.min;e=this.intervals.min+Math.round(n*e/this.awaiting.interval)}else e<this.awaiting.until+this.intervals.slowdown?(e-=this.awaiting.until,n=this.intervals.regular-this.intervals.frequent,e=this.intervals.frequent+Math.round(n*e/this.intervals.slowdown)):(e=void 0===this.since?0:this.intervals.regular,this.awaiting.nonstop=!1);return 1e3*e},Backplane.request=function(){var e=this;if(!this.initialized||!this.runRequests)return!1;this.stopTimer("regular"),this.stopTimer("watchdog"),this.timers.regular=setTimeout(function(){if((e.timers.watchdog=setTimeout(function(){e.request()},5e3),window.localStorage&&!e.since)&&(n=localStorage.getItem("backplaneCacheExpires")))if(n=Date.parse(n),new Date>n)e.log("cache expired"),e.invalidateCache();else if(e.cachedMessages=JSON.parse(localStorage.getItem("backplaneCachedMessages")),e.cachedMessagesIndex=JSON.parse(localStorage.getItem("backplaneCachedMessagesIndex")),e.cachedMessages){for(var n=[],t=0;t<e.cachedMessagesIndex.length;t++)n[t]=e.cachedMessages[e.cachedMessagesIndex[t]];return e.log(n.length+" message(s) in cache"),void e.response(n)}var a=document.createElement("script");a.type="text/javascript",a.charset="utf-8",a.src=e.config.channelID+"?callback=Backplane.response"+(e.since?"&since="+encodeURIComponent(e.since):"")+"&rnd="+Math.random(),(n=document.getElementsByTagName("head")[0]||document.documentElement).insertBefore(a,n.firstChild),a.onload=a.onreadystatechange=function(){var e=a.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,a.parentNode&&a.parentNode.removeChild(a))}},this.calcTimeout())},Backplane.response=function(e){this.stopTimer("watchdog");var n=(e=e||[]).length?e[e.length-1].id:this.since;for(void 0===this.since&&(e=void 0!==this.config.initFrameFilter?this.config.initFrameFilter(e):[]),this.since=n||"",n=0;n<e.length;n++){for(var t in this.subscribers)this.subscribers.hasOwnProperty(t)&&this.subscribers[t](e[n].message);if(0<this.cacheMax&&(this.cachedMessages.hasOwnProperty([e[n].id])||(this.cachedMessages[e[n].id]=e[n],this.cachedMessagesIndex.push(e[n].id)),this.cachedMessagesIndex.length>this.cacheMax&&(delete this.cachedMessages[this.cachedMessagesIndex[0]],this.cachedMessagesIndex.splice(0,1)),window.localStorage))localStorage.setItem("backplaneCachedMessages",JSON.stringify(this.cachedMessages)),localStorage.setItem("backplaneCachedMessagesIndex",JSON.stringify(this.cachedMessagesIndex)),(a=new Date).setDate(a.getDate()+7),localStorage.setItem("backplaneCacheExpires",a.toUTCString());for(var a=[],i=0;i<this.awaiting.queue.length;i++){for(var s=!1,c=0;c<this.awaiting.queue[i].length;c++)this.awaiting.queue[i][c]==e[n].message.type&&(s=!0);s||a.push(this.awaiting.queue[i])}this.awaiting.queue=a}this.firstFrameReceived=!0,this.request()},Backplane.stopTimer=function(e){(e=this.timers[e])&&clearTimeout(e)}}});